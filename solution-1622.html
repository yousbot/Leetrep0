<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-1622.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-1622.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>1622 - Fancy Sequence</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode 1622. Fancy Sequence Description Write an API that generates fancy sequences using the append, addAll, and multAll operations. Implement the Fancy class: Fancy() Initializes the object with an empty sequence. void append(val) Appends an integer val to the end of the sequence. void addAll(inc) Increments...">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-1622.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-1622.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-1622.html" rel="stylesheet"/>
   <link href="solution-1622.html" rel="stylesheet"/>
   <link href="solution-1622.html" rel="stylesheet"/>
   <link href="solution-1622.html" rel="stylesheet"/>
   <link href="solution-1622.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="1622 - Fancy Sequence" property="og:title"/>
   <meta content="Leetcode 1622. Fancy Sequence Description Write an API that generates fancy sequences using the append, addAll, and multAll operations. Implement the Fancy class: Fancy() Initializes the object with an empty sequence. void append(val) Appends an integer val to the end of the sequence. void addAll(inc) Increments all existing values in the sequence by an integer inc. void multAll(m) Multiplies all existing values in the sequence by an integer m. int getIndex(idx) Gets the current value at index idx (0-indexed) of the sequence modulo 109 + 7. If the index is greater or equal than the length of the sequence, return -1. &amp;nbsp; Example 1: Input [&amp;quot;Fancy&amp;quot;, &amp;quot;append&amp;quot;, &amp;quot;addAll&amp;quot;, &amp;quot;append&amp;quot;, &amp;quot;multAll&amp;quot;, &amp;quot;getIndex&amp;quot;, &amp;quot;addAll&amp;quot;, &amp;quot;append&amp;quot;, &amp;quot;multAll&amp;quot;, &amp;quot;getIndex&amp;quot;, &amp;quot;getIndex&amp;quot;, &amp;quot;getIndex&amp;quot;] [[], [2], [3], [7], [2], [0], [3], [10], [2], [0], [1], [2]] Output [null, null, null, null, null, 10, null, null, null, 26, 34, 20] Explanation Fancy fancy = new Fancy(); fancy.append(2); // fancy sequence: [2] fancy.addAll(3); // fancy sequence: [2+3] -&amp;gt; [5] fancy.append(7); // fancy sequence: [5, 7] fancy.multAll(2); // fancy sequence: [5*2, 7*2] -&amp;gt; [10, 14] fancy.getIndex(0); // return 10 fancy.addAll(3); // fancy sequence: [10+3, 14+3] -&amp;gt; [13, 17] fancy.append(10); // fancy sequence: [13, 17, 10] fancy.multAll(2); // fancy sequence: [13*2, 17*2, 10*2] -&amp;gt; [26, 34, 20] fancy.getIndex(0); // return 26 fancy.getIndex(1); // return 34 fancy.getIndex(2); // return 20 &amp;nbsp; Constraints: 1 &amp;lt;= val, inc, m &amp;lt;= 100 0 &amp;lt;= idx &amp;lt;= 105 At most 105 calls total will be made to append, addAll, multAll, and getIndex. Solutions Java C++ Python class Node { Node left; Node right; int l; int r; int mid; long v; long add; long mul = 1; public Node(int l, int r) { this.l = l; this.r = r; this.mid = (l + r) &amp;gt;&amp;gt; 1; } } class SegmentTree { private Node root = new Node(1, (int) 1e5 + 1); private static final int MOD = (int) 1e9 + 7; public SegmentTree() { } public void modifyAdd(int l, int r, int inc) { modifyAdd(l, r, inc, root); } public void modifyAdd(int l, int r, int inc, Node node) { if (l &amp;gt; r) { return; } if (node.l &amp;gt;= l &amp;amp;&amp;amp; node.r &amp;lt;= r) { node.v = (node.v + (node.r - node.l + 1) * inc) % MOD; node.add = (node.add + inc) % MOD; return; } pushdown(node); if (l &amp;lt;= node.mid) { modifyAdd(l, r, inc, node.left); } if (r &amp;gt; node.mid) { modifyAdd(l, r, inc, node.right); } pushup(node); } public void modifyMul(int l, int r, int m) { modifyMul(l, r, m, root); } public void modifyMul(int l, int r, int m, Node node) { if (l &amp;gt; r) { return; } if (node.l &amp;gt;= l &amp;amp;&amp;amp; node.r &amp;lt;= r) { node.v = (node.v * m) % MOD; node.add = (node.add * m) % MOD; node.mul = (node.mul * m) % MOD; return; } pushdown(node); if (l &amp;lt;= node.mid) { modifyMul(l, r, m, node.left); } if (r &amp;gt; node.mid) { modifyMul(l, r, m, node.right); } pushup(node); } public int query(int l,..." property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2020-05-09T00:00:00-07:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2020-05-09-1622-Fancy-Sequence/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-1622.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="1622 - Fancy Sequence" property="twitter:title"/>
   <meta content="Leetcode 1622. Fancy Sequence Description Write an API that generates fancy sequences using the append, addAll, and multAll operations. Implement the Fancy class: Fancy() Initializes the object with an empty sequence. void append(val) Appends an integer val to the end of the sequence. void addAll(inc) Increments all existing values in the sequence by an integer inc. void multAll(m) Multiplies all existing values in the sequence by an integer m. int getIndex(idx) Gets the current value at index idx (0-indexed) of the sequence modulo 109 + 7. If the index is greater or equal than the length of the sequence, return -1. &amp;nbsp; Example 1: Input [&amp;quot;Fancy&amp;quot;, &amp;quot;append&amp;quot;, &amp;quot;addAll&amp;quot;, &amp;quot;append&amp;quot;, &amp;quot;multAll&amp;quot;, &amp;quot;getIndex&amp;quot;, &amp;quot;addAll&amp;quot;, &amp;quot;append&amp;quot;, &amp;quot;multAll&amp;quot;, &amp;quot;getIndex&amp;quot;, &amp;quot;getIndex&amp;quot;, &amp;quot;getIndex&amp;quot;] [[], [2], [3], [7], [2], [0], [3], [10], [2], [0], [1], [2]] Output [null, null, null, null, null, 10, null, null, null, 26, 34, 20] Explanation Fancy fancy = new Fancy(); fancy.append(2); // fancy sequence: [2] fancy.addAll(3); // fancy sequence: [2+3] -&amp;gt; [5] fancy.append(7); // fancy sequence: [5, 7] fancy.multAll(2); // fancy sequence: [5*2, 7*2] -&amp;gt; [10, 14] fancy.getIndex(0); // return 10 fancy.addAll(3); // fancy sequence: [10+3, 14+3] -&amp;gt; [13, 17] fancy.append(10); // fancy sequence: [13, 17, 10] fancy.multAll(2); // fancy sequence: [13*2, 17*2, 10*2] -&amp;gt; [26, 34, 20] fancy.getIndex(0); // return 26 fancy.getIndex(1); // return 34 fancy.getIndex(2); // return 20 &amp;nbsp; Constraints: 1 &amp;lt;= val, inc, m &amp;lt;= 100 0 &amp;lt;= idx &amp;lt;= 105 At most 105 calls total will be made to append, addAll, multAll, and getIndex. Solutions Java C++ Python class Node { Node left; Node right; int l; int r; int mid; long v; long add; long mul = 1; public Node(int l, int r) { this.l = l; this.r = r; this.mid = (l + r) &amp;gt;&amp;gt; 1; } } class SegmentTree { private Node root = new Node(1, (int) 1e5 + 1); private static final int MOD = (int) 1e9 + 7; public SegmentTree() { } public void modifyAdd(int l, int r, int inc) { modifyAdd(l, r, inc, root); } public void modifyAdd(int l, int r, int inc, Node node) { if (l &amp;gt; r) { return; } if (node.l &amp;gt;= l &amp;amp;&amp;amp; node.r &amp;lt;= r) { node.v = (node.v + (node.r - node.l + 1) * inc) % MOD; node.add = (node.add + inc) % MOD; return; } pushdown(node); if (l &amp;lt;= node.mid) { modifyAdd(l, r, inc, node.left); } if (r &amp;gt; node.mid) { modifyAdd(l, r, inc, node.right); } pushup(node); } public void modifyMul(int l, int r, int m) { modifyMul(l, r, m, root); } public void modifyMul(int l, int r, int m, Node node) { if (l &amp;gt; r) { return; } if (node.l &amp;gt;= l &amp;amp;&amp;amp; node.r &amp;lt;= r) { node.v = (node.v * m) % MOD; node.add = (node.add * m) % MOD; node.mul = (node.mul * m) % MOD; return; } pushdown(node); if (l &amp;lt;= node.mid) { modifyMul(l, r, m, node.left); } if (r &amp;gt; node.mid) { modifyMul(l, r, m, node.right); } pushup(node); } public int query(int l,..." property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    1622 - Fancy Sequence | Leetcode
   </title>
   <meta content="Jekyll v3.10.0" name="generator">
    <meta content="1622 - Fancy Sequence" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-1622.html" rel="canonical">
          <meta content="https://leetcode.ca/2020-05-09-1622-Fancy-Sequence/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2020-05-09T00:00:00-07:00" property="article:published_time">
              <script type="application/ld+json">
               {"description":"Leetcode","headline":"1622 - Fancy Sequence","dateModified":"2020-05-09T00:00:00-07:00","datePublished":"2020-05-09T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2020-05-09-1622-Fancy-Sequence/"},"url":"https://leetcode.ca/2020-05-09-1622-Fancy-Sequence/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCslk3mmaMJy1enit3L9vWig" data-count="hidden" data-layout="full">
      </div>
      <h1 id="1622-fancy-sequence">
       <a href="solution-1622.html">
        1622. Fancy Sequence
       </a>
      </h1>
      <h2 id="description">
       Description
      </h2>
      <p>
       Write an API that generates fancy sequences using the
       <code>
        append
       </code>
       ,
       <code>
        addAll
       </code>
       , and
       <code>
        multAll
       </code>
       operations.
      </p>
      <p>
       Implement the
       <code>
        Fancy
       </code>
       class:
      </p>
      <ul>
       <li>
        <code>
         Fancy()
        </code>
        Initializes the object with an empty sequence.
       </li>
       <li>
        <code>
         void append(val)
        </code>
        Appends an integer
        <code>
         val
        </code>
        to the end of the sequence.
       </li>
       <li>
        <code>
         void addAll(inc)
        </code>
        Increments all existing values in the sequence by an integer
        <code>
         inc
        </code>
        .
       </li>
       <li>
        <code>
         void multAll(m)
        </code>
        Multiplies all existing values in the sequence by an integer
        <code>
         m
        </code>
        .
       </li>
       <li>
        <code>
         int getIndex(idx)
        </code>
        Gets the current value at index
        <code>
         idx
        </code>
        (0-indexed) of the sequence
        <strong>
         modulo
        </strong>
        <code>
         10
         <sup>
          9
         </sup>
         + 7
        </code>
        . If the index is greater or equal than the length of the sequence, return
        <code>
         -1
        </code>
        .
       </li>
      </ul>
      <p>
      </p>
      <p>
       <strong class="example">
        Example 1:
       </strong>
      </p>
      <pre>
<strong>Input</strong>
["Fancy", "append", "addAll", "append", "multAll", "getIndex", "addAll", "append", "multAll", "getIndex", "getIndex", "getIndex"]
[[], [2], [3], [7], [2], [0], [3], [10], [2], [0], [1], [2]]
<strong>Output</strong>
[null, null, null, null, null, 10, null, null, null, 26, 34, 20]

<strong>Explanation</strong>
Fancy fancy = new Fancy();
fancy.append(2);   // fancy sequence: [2]
fancy.addAll(3);   // fancy sequence: [2+3] -&gt; [5]
fancy.append(7);   // fancy sequence: [5, 7]
fancy.multAll(2);  // fancy sequence: [5*2, 7*2] -&gt; [10, 14]
fancy.getIndex(0); // return 10
fancy.addAll(3);   // fancy sequence: [10+3, 14+3] -&gt; [13, 17]
fancy.append(10);  // fancy sequence: [13, 17, 10]
fancy.multAll(2);  // fancy sequence: [13*2, 17*2, 10*2] -&gt; [26, 34, 20]
fancy.getIndex(0); // return 26
fancy.getIndex(1); // return 34
fancy.getIndex(2); // return 20
</pre>
      <p>
      </p>
      <p>
       <strong>
        Constraints:
       </strong>
      </p>
      <ul>
       <li>
        <code>
         1 &lt;= val, inc, m &lt;= 100
        </code>
       </li>
       <li>
        <code>
         0 &lt;= idx &lt;= 10
         <sup>
          5
         </sup>
        </code>
       </li>
       <li>
        At most
        <code>
         10
         <sup>
          5
         </sup>
        </code>
        calls total will be made to
        <code>
         append
        </code>
        ,
        <code>
         addAll
        </code>
        ,
        <code>
         multAll
        </code>
        , and
        <code>
         getIndex
        </code>
        .
       </li>
      </ul>
      <h2 id="solutions">
       Solutions
      </h2>
      <ul class="uk-tab" data-uk-switcher="{connect:'#0ca00850-b49e-4159-80f1-2d61c042eb94'}">
       <li class="uk-active">
        <a href="solution-1622.html">
         Java
        </a>
       </li>
       <li>
        <a href="solution-1622.html">
         C++
        </a>
       </li>
       <li>
        <a href="solution-1622.html">
         Python
        </a>
       </li>
      </ul>
      <ul class="uk-switcher uk-margin" id="0ca00850-b49e-4159-80f1-2d61c042eb94">
       <li>
        <div class="language-java highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kd">class</span> <span class="nc">Node</span> <span class="o">{</span>
    <span class="nc">Node</span> <span class="n">left</span><span class="o">;</span>
    <span class="nc">Node</span> <span class="n">right</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">r</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">v</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">add</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mid</span> <span class="o">=</span> <span class="o">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="o">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SegmentTree</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Node</span> <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="mi">1</span><span class="n">e5</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MOD</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="mi">1</span><span class="n">e9</span> <span class="o">+</span> <span class="mi">7</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SegmentTree</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modifyAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="kt">int</span> <span class="n">inc</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">modifyAdd</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">inc</span><span class="o">,</span> <span class="n">root</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modifyAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="kt">int</span> <span class="n">inc</span><span class="o">,</span> <span class="nc">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">node</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">v</span> <span class="o">+</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">r</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="na">l</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">inc</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">node</span><span class="o">.</span><span class="na">add</span> <span class="o">=</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">add</span> <span class="o">+</span> <span class="n">inc</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">pushdown</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">modifyAdd</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">inc</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">left</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">modifyAdd</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">inc</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">right</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">pushup</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modifyMul</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="kt">int</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">modifyMul</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">root</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modifyMul</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="kt">int</span> <span class="n">m</span><span class="o">,</span> <span class="nc">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">node</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">v</span> <span class="o">*</span> <span class="n">m</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">node</span><span class="o">.</span><span class="na">add</span> <span class="o">=</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">add</span> <span class="o">*</span> <span class="n">m</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">=</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">*</span> <span class="n">m</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">pushdown</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">modifyMul</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">left</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">modifyMul</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">right</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">pushup</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">query</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">query</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">root</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">query</span><span class="o">(</span><span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">,</span> <span class="nc">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">node</span><span class="o">.</span><span class="na">v</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">pushdown</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">query</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">left</span><span class="o">))</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">query</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">right</span><span class="o">))</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pushup</span><span class="o">(</span><span class="nc">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">node</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">v</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">v</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pushdown</span><span class="o">(</span><span class="nc">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">left</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">node</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">l</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">mid</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">right</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">node</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="na">r</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">add</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Node</span> <span class="n">left</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">right</span><span class="o">;</span>
            <span class="n">left</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">v</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">+</span> <span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">r</span> <span class="o">-</span> <span class="n">left</span><span class="o">.</span><span class="na">l</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">add</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">right</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">right</span><span class="o">.</span><span class="na">v</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">+</span> <span class="o">(</span><span class="n">right</span><span class="o">.</span><span class="na">r</span> <span class="o">-</span> <span class="n">right</span><span class="o">.</span><span class="na">l</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">add</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">left</span><span class="o">.</span><span class="na">add</span> <span class="o">=</span> <span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">add</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="na">add</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">right</span><span class="o">.</span><span class="na">add</span> <span class="o">=</span> <span class="o">(</span><span class="n">right</span><span class="o">.</span><span class="na">add</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="na">add</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">left</span><span class="o">.</span><span class="na">mul</span> <span class="o">=</span> <span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">mul</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">right</span><span class="o">.</span><span class="na">mul</span> <span class="o">=</span> <span class="o">(</span><span class="n">right</span><span class="o">.</span><span class="na">mul</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="na">mul</span><span class="o">)</span> <span class="o">%</span> <span class="no">MOD</span><span class="o">;</span>
            <span class="n">node</span><span class="o">.</span><span class="na">add</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="n">node</span><span class="o">.</span><span class="na">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Fancy</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">SegmentTree</span> <span class="n">tree</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SegmentTree</span><span class="o">();</span>

    <span class="kd">public</span> <span class="nf">Fancy</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">append</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">++</span><span class="n">n</span><span class="o">;</span>
        <span class="n">tree</span><span class="o">.</span><span class="na">modifyAdd</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addAll</span><span class="o">(</span><span class="kt">int</span> <span class="n">inc</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">tree</span><span class="o">.</span><span class="na">modifyAdd</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">inc</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">multAll</span><span class="o">(</span><span class="kt">int</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">tree</span><span class="o">.</span><span class="na">modifyMul</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">m</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getIndex</span><span class="o">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">tree</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
 * Your Fancy object will be instantiated and called as such:
 * Fancy obj = new Fancy();
 * obj.append(val);
 * obj.addAll(inc);
 * obj.multAll(m);
 * int param_4 = obj.getIndex(idx);
 */</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-cpp highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="k">const</span> <span class="kt">int</span> <span class="n">MOD</span> <span class="o">=</span> <span class="mf">1e9</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Node</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">left</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">right</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mid</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">add</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">mul</span><span class="p">;</span>

    <span class="n">Node</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">add</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">SegmentTree</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">root</span><span class="p">;</span>

<span class="nl">public:</span>
    <span class="n">SegmentTree</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">modifyAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">inc</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">modifyAdd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">modifyAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">inc</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">+</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">-</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">inc</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">+</span> <span class="n">inc</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">pushdown</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">)</span> <span class="n">modifyAdd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">)</span> <span class="n">modifyAdd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
        <span class="n">pushup</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">modifyMul</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">modifyMul</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">modifyMul</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">pushdown</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">)</span> <span class="n">modifyMul</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">)</span> <span class="n">modifyMul</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
        <span class="n">pushup</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span> <span class="k">return</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
        <span class="n">pushdown</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">)</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">)</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">))</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">pushup</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">+</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">pushdown</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">||</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">long</span> <span class="n">add</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">mul</span><span class="p">;</span>
            <span class="n">Node</span><span class="o">*</span> <span class="n">left</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>
            <span class="n">Node</span><span class="o">*</span> <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">;</span>
            <span class="n">left</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="p">(</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">-</span> <span class="n">left</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">right</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">-</span> <span class="n">right</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">left</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">right</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">*</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">left</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">*</span> <span class="n">mul</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">right</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">*</span> <span class="n">mul</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">add</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">node</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Fancy</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">SegmentTree</span><span class="o">*</span> <span class="n">tree</span><span class="p">;</span>

    <span class="n">Fancy</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SegmentTree</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">append</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">n</span><span class="p">;</span>
        <span class="n">tree</span><span class="o">-&gt;</span><span class="n">modifyAdd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">addAll</span><span class="p">(</span><span class="kt">int</span> <span class="n">inc</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tree</span><span class="o">-&gt;</span><span class="n">modifyAdd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">inc</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">multAll</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tree</span><span class="o">-&gt;</span><span class="n">modifyMul</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">getIndex</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">tree</span><span class="o">-&gt;</span><span class="n">query</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**
 * Your Fancy object will be instantiated and called as such:
 * Fancy* obj = new Fancy();
 * obj-&gt;append(val);
 * obj-&gt;addAll(inc);
 * obj-&gt;multAll(m);
 * int param_4 = obj-&gt;getIndex(idx);
 */</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-py highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="n">MOD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e9</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">right</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">add</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span>


<span class="k">class</span> <span class="nc">SegmentTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">modifyAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">node</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">v</span> <span class="o">+</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">node</span><span class="p">.</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">inc</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">node</span><span class="p">.</span><span class="n">add</span> <span class="o">+=</span> <span class="n">inc</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pushdown</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">modifyAdd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">modifyAdd</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pushup</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">modifyMul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">node</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">v</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">node</span><span class="p">.</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">add</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pushdown</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">modifyMul</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">modifyMul</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pushup</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="n">v</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pushdown</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">))</span> <span class="o">%</span> <span class="n">MOD</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">))</span> <span class="o">%</span> <span class="n">MOD</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">pushup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>

    <span class="k">def</span> <span class="nf">pushdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">left</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span><span class="p">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">l</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">mid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">right</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span><span class="p">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">right</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">add</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">left</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">v</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">+</span> <span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">left</span><span class="p">.</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">right</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">v</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">right</span><span class="p">.</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">left</span><span class="p">.</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">add</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">right</span><span class="p">.</span><span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">add</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="n">add</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">left</span><span class="p">.</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">mul</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">right</span><span class="p">.</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">mul</span> <span class="o">*</span> <span class="n">node</span><span class="p">.</span><span class="n">mul</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span>
            <span class="n">node</span><span class="p">.</span><span class="n">add</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">node</span><span class="p">.</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span>


<span class="k">class</span> <span class="nc">Fancy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">SegmentTree</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="n">modifyAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="n">modifyAdd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">multAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="n">modifyMul</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="p">.</span><span class="n">n</span> <span class="k">else</span> <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1"># Your Fancy object will be instantiated and called as such:
# obj = Fancy()
# obj.append(val)
# obj.addAll(inc)
# obj.multAll(m)
# param_4 = obj.getIndex(idx)
</span>
</code></pre>
         </div>
        </div>
       </li>
      </ul>
      
     </article>
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-1622.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
