<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-772.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-772.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>772 - Basic Calculator III</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode Formatted question description: https://leetcode.ca/all/772.html 772. Basic Calculator III Level Hard Description Implement a basic calculator to evaluate a simple expression string. The expression string contains only non-negative integers, &amp;#39;+&amp;#39;, &amp;#39;-&amp;#39;, &amp;#39;*&amp;#39;, &amp;#39;/&amp;#39; operators, and open &amp;#39;(&amp;#39; and closing parentheses &amp;#39;)&amp;#39;. The integer division should truncate...">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-772.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-772.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-772.html" rel="stylesheet"/>
   <link href="solution-772.html" rel="stylesheet"/>
   <link href="solution-772.html" rel="stylesheet"/>
   <link href="solution-772.html" rel="stylesheet"/>
   <link href="solution-772.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="772 - Basic Calculator III" property="og:title"/>
   <meta content='Leetcode Formatted question description: https://leetcode.ca/all/772.html 772. Basic Calculator III Level Hard Description Implement a basic calculator to evaluate a simple expression string. The expression string contains only non-negative integers, &amp;#39;+&amp;#39;, &amp;#39;-&amp;#39;, &amp;#39;*&amp;#39;, &amp;#39;/&amp;#39; operators, and open &amp;#39;(&amp;#39; and closing parentheses &amp;#39;)&amp;#39;. The integer division should truncate toward zero. You may assume that the given expression is always valid. All intermediate results will be in the range of [-231, 231 - 1]. Note: You are not allowed to use any built-in function which evaluates strings as mathematical expressions, such as eval(). &amp;nbsp; Example 1: Input: s = &amp;quot;1+1&amp;quot; Output: 2 Example 2: Input: s = &amp;quot;6-4/2&amp;quot; Output: 4 Example 3: Input: s = &amp;quot;2*(5+5*2)/3+(6/2+8)&amp;quot; Output: 21 &amp;nbsp; Constraints: 1 &amp;lt;= s &amp;lt;= 104 s consists of digits, &amp;#39;+&amp;#39;, &amp;#39;-&amp;#39;, &amp;#39;*&amp;#39;, &amp;#39;/&amp;#39;, &amp;#39;(&amp;#39;,&amp;nbsp;and&amp;nbsp;&amp;#39;)&amp;#39;. s is a valid expression. Solution The expression may include integers, addition (+), subtraction (-), multiplication (*), division (/), and parentheses to dictate the order of operations. The approach uses Depth-First Search (DFS) recursion to handle the computation, particularly for expressions within parentheses. Hereâs a breakdown of how the code operates: Main Function: calculate Variables Initialization: A stack to store intermediate results, num to accumulate numeric values, and op to hold the current operation (initialized to + for the first number). Iteration: The function iterates through each character c in the input string s, using i as the index. Number Parsing: If c is a digit, it updates num to include this digit (accounting for multi-digit numbers). Handling Parentheses: If c is "(", it finds the corresponding closing parenthesis using findClosing and recursively calculates the value of the expression inside the parentheses. i is updated to the index of the closing parenthesis to skip the evaluated expression. Applying Operations: When an operation character ("+-*/") is encountered or the end of the string is reached (i == len(s) - 1), the code applies the previous operation (op) to the current num and the top of the stack if necessary. The current operation c is stored in op, and num is reset to 0 for the next number. Stack Summation: After processing all characters, the function sums up the values in the stack. This sum represents the final result since the stack accumulates all partial results adjusted by their respective operations. Helper Function: findClosing This function finds the index of the closing parenthesis corresponding to the opening parenthesis at index i. It uses a level variable to handle nested parentheses by incrementing level for each opening parenthesis and decrementing it for each closing parenthesis. When level returns to 0, it means the corresponding closing parenthesis is found. Example Given the expression s = "1 + (2 - (2 + 3) * 4 / (1 + 1)) * 2", the code correctly calculates its value by: Parsing numbers and operations at the top level. Recursively evaluating expressions inside parentheses. Applying the operations to the accumulated numbers and using the stack to manage intermediate results. Letâs walk through the...' property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2018-01-10T21:21:01-08:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2018-01-10-772-Basic-Calculator-III/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-772.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="772 - Basic Calculator III" property="twitter:title"/>
   <meta content='Leetcode Formatted question description: https://leetcode.ca/all/772.html 772. Basic Calculator III Level Hard Description Implement a basic calculator to evaluate a simple expression string. The expression string contains only non-negative integers, &amp;#39;+&amp;#39;, &amp;#39;-&amp;#39;, &amp;#39;*&amp;#39;, &amp;#39;/&amp;#39; operators, and open &amp;#39;(&amp;#39; and closing parentheses &amp;#39;)&amp;#39;. The integer division should truncate toward zero. You may assume that the given expression is always valid. All intermediate results will be in the range of [-231, 231 - 1]. Note: You are not allowed to use any built-in function which evaluates strings as mathematical expressions, such as eval(). &amp;nbsp; Example 1: Input: s = &amp;quot;1+1&amp;quot; Output: 2 Example 2: Input: s = &amp;quot;6-4/2&amp;quot; Output: 4 Example 3: Input: s = &amp;quot;2*(5+5*2)/3+(6/2+8)&amp;quot; Output: 21 &amp;nbsp; Constraints: 1 &amp;lt;= s &amp;lt;= 104 s consists of digits, &amp;#39;+&amp;#39;, &amp;#39;-&amp;#39;, &amp;#39;*&amp;#39;, &amp;#39;/&amp;#39;, &amp;#39;(&amp;#39;,&amp;nbsp;and&amp;nbsp;&amp;#39;)&amp;#39;. s is a valid expression. Solution The expression may include integers, addition (+), subtraction (-), multiplication (*), division (/), and parentheses to dictate the order of operations. The approach uses Depth-First Search (DFS) recursion to handle the computation, particularly for expressions within parentheses. Hereâs a breakdown of how the code operates: Main Function: calculate Variables Initialization: A stack to store intermediate results, num to accumulate numeric values, and op to hold the current operation (initialized to + for the first number). Iteration: The function iterates through each character c in the input string s, using i as the index. Number Parsing: If c is a digit, it updates num to include this digit (accounting for multi-digit numbers). Handling Parentheses: If c is "(", it finds the corresponding closing parenthesis using findClosing and recursively calculates the value of the expression inside the parentheses. i is updated to the index of the closing parenthesis to skip the evaluated expression. Applying Operations: When an operation character ("+-*/") is encountered or the end of the string is reached (i == len(s) - 1), the code applies the previous operation (op) to the current num and the top of the stack if necessary. The current operation c is stored in op, and num is reset to 0 for the next number. Stack Summation: After processing all characters, the function sums up the values in the stack. This sum represents the final result since the stack accumulates all partial results adjusted by their respective operations. Helper Function: findClosing This function finds the index of the closing parenthesis corresponding to the opening parenthesis at index i. It uses a level variable to handle nested parentheses by incrementing level for each opening parenthesis and decrementing it for each closing parenthesis. When level returns to 0, it means the corresponding closing parenthesis is found. Example Given the expression s = "1 + (2 - (2 + 3) * 4 / (1 + 1)) * 2", the code correctly calculates its value by: Parsing numbers and operations at the top level. Recursively evaluating expressions inside parentheses. Applying the operations to the accumulated numbers and using the stack to manage intermediate results. Letâs walk through the...' property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    772 - Basic Calculator III | Leetcode
   </title>
   <meta content="Jekyll v3.10.0" name="generator">
    <meta content="772 - Basic Calculator III" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-772.html" rel="canonical">
          <meta content="https://leetcode.ca/2018-01-10-772-Basic-Calculator-III/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2018-01-10T21:21:01-08:00" property="article:published_time">
              <script type="application/ld+json">
               {"description":"Leetcode","headline":"772 - Basic Calculator III","dateModified":"2018-01-10T21:21:01-08:00","datePublished":"2018-01-10T21:21:01-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2018-01-10-772-Basic-Calculator-III/"},"url":"https://leetcode.ca/2018-01-10-772-Basic-Calculator-III/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCslk3mmaMJy1enit3L9vWig" data-count="hidden" data-layout="full">
      </div>
      <p>
       Formatted question description:
       <a href="solution-772.html">
        https://leetcode.ca/all/772.html
       </a>
      </p>
      <h1 id="772-basic-calculator-iii">
       772. Basic Calculator III
      </h1>
      <h2 id="level">
       Level
      </h2>
      <p>
       Hard
      </p>
      <h2 id="description">
       Description
      </h2>
      <p>
       Implement a basic calculator to evaluate a simple expression string.
      </p>
      <p>
       The expression string contains only non-negative integers,
       <code>
        '+'
       </code>
       ,
       <code>
        '-'
       </code>
       ,
       <code>
        '*'
       </code>
       ,
       <code>
        '/'
       </code>
       operators, and open
       <code>
        '('
       </code>
       and closing parentheses
       <code>
        ')'
       </code>
       . The integer division should
       <strong>
        truncate toward zero
       </strong>
       .
      </p>
      <p>
       You may assume that the given expression is always valid. All intermediate results will be in the range of
       <code>
        [-2
        <sup>
         31
        </sup>
        , 2
        <sup>
         31
        </sup>
        - 1]
       </code>
       .
      </p>
      <p>
       <strong>
        Note:
       </strong>
       You are not allowed to use any built-in function which evaluates strings as mathematical expressions, such as
       <code>
        eval()
       </code>
       .
      </p>
      <p>
      </p>
      <p>
       <strong class="example">
        Example 1:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> s = "1+1"
<strong>Output:</strong> 2
</pre>
      <p>
       <strong class="example">
        Example 2:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> s = "6-4/2"
<strong>Output:</strong> 4
</pre>
      <p>
       <strong class="example">
        Example 3:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> s = "2*(5+5*2)/3+(6/2+8)"
<strong>Output:</strong> 21
</pre>
      <p>
      </p>
      <p>
       <strong>
        Constraints:
       </strong>
      </p>
      <ul>
       <li>
        <code>
         1 &lt;= s &lt;= 10
         <sup>
          4
         </sup>
        </code>
       </li>
       <li>
        <code>
         s
        </code>
        consists of digits,
        <code>
         '+'
        </code>
        ,
        <code>
         '-'
        </code>
        ,
        <code>
         '*'
        </code>
        ,
        <code>
         '/'
        </code>
        ,
        <code>
         '('
        </code>
        , and
        <code>
         ')'
        </code>
        .
       </li>
       <li>
        <code>
         s
        </code>
        is a
        <strong>
         valid
        </strong>
        expression.
       </li>
      </ul>
      <h2 id="solution">
       Solution
      </h2>
      <p>
       The expression may include integers, addition (
       <code class="language-plaintext highlighter-rouge">
        +
       </code>
       ), subtraction (
       <code class="language-plaintext highlighter-rouge">
        -
       </code>
       ), multiplication (
       <code class="language-plaintext highlighter-rouge">
        *
       </code>
       ), division (
       <code class="language-plaintext highlighter-rouge">
        /
       </code>
       ), and parentheses to dictate the order of operations. The approach uses Depth-First Search (DFS) recursion to handle the computation, particularly for expressions within parentheses. Hereâs a breakdown of how the code operates:
      </p>
      <h3 id="main-function-calculate">
       Main Function:
       <code class="language-plaintext highlighter-rouge">
        calculate
       </code>
      </h3>
      <ul>
       <li>
        <p>
         <strong>
          Variables Initialization
         </strong>
         : A
         <code class="language-plaintext highlighter-rouge">
          stack
         </code>
         to store intermediate results,
         <code class="language-plaintext highlighter-rouge">
          num
         </code>
         to accumulate numeric values, and
         <code class="language-plaintext highlighter-rouge">
          op
         </code>
         to hold the current operation (initialized to
         <code class="language-plaintext highlighter-rouge">
          +
         </code>
         for the first number).
        </p>
       </li>
       <li>
        <p>
         <strong>
          Iteration
         </strong>
         : The function iterates through each character
         <code class="language-plaintext highlighter-rouge">
          c
         </code>
         in the input string
         <code class="language-plaintext highlighter-rouge">
          s
         </code>
         , using
         <code class="language-plaintext highlighter-rouge">
          i
         </code>
         as the index.
        </p>
        <ul>
         <li>
          <p>
           <strong>
            Number Parsing
           </strong>
           : If
           <code class="language-plaintext highlighter-rouge">
            c
           </code>
           is a digit, it updates
           <code class="language-plaintext highlighter-rouge">
            num
           </code>
           to include this digit (accounting for multi-digit numbers).
          </p>
         </li>
         <li>
          <p>
           <strong>
            Handling Parentheses
           </strong>
           : If
           <code class="language-plaintext highlighter-rouge">
            c
           </code>
           is
           <code class="language-plaintext highlighter-rouge">
            "("
           </code>
           , it finds the corresponding closing parenthesis using
           <code class="language-plaintext highlighter-rouge">
            findClosing
           </code>
           and recursively calculates the value of the expression inside the parentheses.
           <code class="language-plaintext highlighter-rouge">
            i
           </code>
           is updated to the index of the closing parenthesis to skip the evaluated expression.
          </p>
         </li>
         <li>
          <p>
           <strong>
            Applying Operations
           </strong>
           : When an operation character (
           <code class="language-plaintext highlighter-rouge">
            "+-*/"
           </code>
           ) is encountered or the end of the string is reached (
           <code class="language-plaintext highlighter-rouge">
            i == len(s) - 1
           </code>
           ), the code applies the previous operation (
           <code class="language-plaintext highlighter-rouge">
            op
           </code>
           ) to the current
           <code class="language-plaintext highlighter-rouge">
            num
           </code>
           and the top of the stack if necessary. The current operation
           <code class="language-plaintext highlighter-rouge">
            c
           </code>
           is stored in
           <code class="language-plaintext highlighter-rouge">
            op
           </code>
           , and
           <code class="language-plaintext highlighter-rouge">
            num
           </code>
           is reset to
           <code class="language-plaintext highlighter-rouge">
            0
           </code>
           for the next number.
          </p>
         </li>
        </ul>
       </li>
       <li>
        <p>
         <strong>
          Stack Summation
         </strong>
         : After processing all characters, the function sums up the values in the stack. This sum represents the final result since the stack accumulates all partial results adjusted by their respective operations.
        </p>
       </li>
      </ul>
      <h3 id="helper-function-findclosing">
       Helper Function:
       <code class="language-plaintext highlighter-rouge">
        findClosing
       </code>
      </h3>
      <ul>
       <li>
        This function finds the index of the closing parenthesis corresponding to the opening parenthesis at index
        <code class="language-plaintext highlighter-rouge">
         i
        </code>
        . It uses a
        <code class="language-plaintext highlighter-rouge">
         level
        </code>
        variable to handle nested parentheses by incrementing
        <code class="language-plaintext highlighter-rouge">
         level
        </code>
        for each opening parenthesis and decrementing it for each closing parenthesis. When
        <code class="language-plaintext highlighter-rouge">
         level
        </code>
        returns to
        <code class="language-plaintext highlighter-rouge">
         0
        </code>
        , it means the corresponding closing parenthesis is found.
       </li>
      </ul>
      <h2 id="example">
       Example
      </h2>
      <p>
       Given the expression
       <code class="language-plaintext highlighter-rouge">
        s = "1 + (2 - (2 + 3) * 4 / (1 + 1)) * 2"
       </code>
       , the code correctly calculates its value by:
      </p>
      <ul>
       <li>
        Parsing numbers and operations at the top level.
       </li>
       <li>
        Recursively evaluating expressions inside parentheses.
       </li>
       <li>
        Applying the operations to the accumulated numbers and using the stack to manage intermediate results.
       </li>
      </ul>
      <p>
       Letâs walk through the evaluation step by step, focusing on the recursion invoked by the parentheses.
      </p>
      <h3 id="initial-setup">
       Initial Setup
      </h3>
      <ul>
       <li>
        Start with
        <code class="language-plaintext highlighter-rouge">
         s
        </code>
        , an empty stack,
        <code class="language-plaintext highlighter-rouge">
         num = 0
        </code>
        , and
        <code class="language-plaintext highlighter-rouge">
         op = "+"
        </code>
        .
       </li>
      </ul>
      <h3 id="first-level-of-calculation">
       First Level of Calculation
      </h3>
      <ul>
       <li>
        Iterate through
        <code class="language-plaintext highlighter-rouge">
         s
        </code>
        . The first non-whitespace character is
        <code class="language-plaintext highlighter-rouge">
         "1"
        </code>
        , which is a digit, so
        <code class="language-plaintext highlighter-rouge">
         num = 1
        </code>
        .
       </li>
       <li>
        Encounter
        <code class="language-plaintext highlighter-rouge">
         " + "
        </code>
        . Since
        <code class="language-plaintext highlighter-rouge">
         op
        </code>
        is
        <code class="language-plaintext highlighter-rouge">
         "+"
        </code>
        , push
        <code class="language-plaintext highlighter-rouge">
         1
        </code>
        onto the stack.
       </li>
       <li>
        Next, encounter
        <code class="language-plaintext highlighter-rouge">
         "("
        </code>
        which indicates the start of a sub-expression. Find the corresponding closing parenthesis and recursively calculate the expression inside
        <code class="language-plaintext highlighter-rouge">
         "(2 - (2 + 3) * 4 / (1 + 1))"
        </code>
        .
       </li>
      </ul>
      <h3 id="first-recursion-2---2--3--4--1--1">
       First Recursion:
       <code class="language-plaintext highlighter-rouge">
        "2 - (2 + 3) * 4 / (1 + 1)"
       </code>
      </h3>
      <ul>
       <li>
        Reset:
        <code class="language-plaintext highlighter-rouge">
         num = 0
        </code>
        ,
        <code class="language-plaintext highlighter-rouge">
         op = "+"
        </code>
        , and a new stack.
       </li>
       <li>
        Parse
        <code class="language-plaintext highlighter-rouge">
         "2"
        </code>
        , encounter
        <code class="language-plaintext highlighter-rouge">
         " - "
        </code>
        , push
        <code class="language-plaintext highlighter-rouge">
         2
        </code>
        onto the stack.
       </li>
       <li>
        Encounter another
        <code class="language-plaintext highlighter-rouge">
         "("
        </code>
        , indicating a nested sub-expression. Recursively calculate the expression inside
        <code class="language-plaintext highlighter-rouge">
         "(2 + 3)"
        </code>
        .
       </li>
      </ul>
      <h4 id="second-recursion-2--3">
       Second Recursion:
       <code class="language-plaintext highlighter-rouge">
        "2 + 3"
       </code>
      </h4>
      <ul>
       <li>
        Reset:
        <code class="language-plaintext highlighter-rouge">
         num = 0
        </code>
        ,
        <code class="language-plaintext highlighter-rouge">
         op = "+"
        </code>
        , and a new stack.
       </li>
       <li>
        Parse
        <code class="language-plaintext highlighter-rouge">
         "2"
        </code>
        , then
        <code class="language-plaintext highlighter-rouge">
         " + "
        </code>
        , push
        <code class="language-plaintext highlighter-rouge">
         2
        </code>
        onto the stack.
       </li>
       <li>
        Parse
        <code class="language-plaintext highlighter-rouge">
         "3"
        </code>
        , and since we reach the end, use
        <code class="language-plaintext highlighter-rouge">
         op
        </code>
        to add
        <code class="language-plaintext highlighter-rouge">
         3
        </code>
        to the stack.
       </li>
       <li>
        Sum the stack:
        <code class="language-plaintext highlighter-rouge">
         2 + 3 = 5
        </code>
        . Return
        <code class="language-plaintext highlighter-rouge">
         5
        </code>
        to the first recursion.
       </li>
      </ul>
      <h3 id="back-to-first-recursion-with-5-from-second-recursion">
       Back to First Recursion with
       <code class="language-plaintext highlighter-rouge">
        5
       </code>
       from Second Recursion
      </h3>
      <ul>
       <li>
        After replacing
        <code class="language-plaintext highlighter-rouge">
         "(2 + 3)"
        </code>
        with
        <code class="language-plaintext highlighter-rouge">
         5
        </code>
        , the expression becomes
        <code class="language-plaintext highlighter-rouge">
         "2 - 5 * 4 / (1 + 1)"
        </code>
        .
       </li>
       <li>
        Continue parsing:
        <code class="language-plaintext highlighter-rouge">
         " - 5"
        </code>
        results in pushing
        <code class="language-plaintext highlighter-rouge">
         -5
        </code>
        onto the stack (because of the previous
        <code class="language-plaintext highlighter-rouge">
         op = "-"
        </code>
        ).
       </li>
       <li>
        Parse
        <code class="language-plaintext highlighter-rouge">
         " * 4"
        </code>
        , update
        <code class="language-plaintext highlighter-rouge">
         op
        </code>
        to
        <code class="language-plaintext highlighter-rouge">
         "*"
        </code>
        , and keep
        <code class="language-plaintext highlighter-rouge">
         num = 4
        </code>
        .
       </li>
       <li>
        Encounter
        <code class="language-plaintext highlighter-rouge">
         "("
        </code>
        again, so calculate the expression inside
        <code class="language-plaintext highlighter-rouge">
         "(1 + 1)"
        </code>
        .
       </li>
      </ul>
      <h4 id="third-recursion-1--1">
       Third Recursion:
       <code class="language-plaintext highlighter-rouge">
        "1 + 1"
       </code>
      </h4>
      <ul>
       <li>
        Reset:
        <code class="language-plaintext highlighter-rouge">
         num = 0
        </code>
        ,
        <code class="language-plaintext highlighter-rouge">
         op = "+"
        </code>
        , and a new stack.
       </li>
       <li>
        Parse
        <code class="language-plaintext highlighter-rouge">
         "1"
        </code>
        , encounter
        <code class="language-plaintext highlighter-rouge">
         " + "
        </code>
        , push
        <code class="language-plaintext highlighter-rouge">
         1
        </code>
        onto the stack.
       </li>
       <li>
        Parse
        <code class="language-plaintext highlighter-rouge">
         "1"
        </code>
        , and since we reach the end, use
        <code class="language-plaintext highlighter-rouge">
         op
        </code>
        to add
        <code class="language-plaintext highlighter-rouge">
         1
        </code>
        to the stack.
       </li>
       <li>
        Sum the stack:
        <code class="language-plaintext highlighter-rouge">
         1 + 1 = 2
        </code>
        . Return
        <code class="language-plaintext highlighter-rouge">
         2
        </code>
        to the first recursion.
       </li>
      </ul>
      <h3 id="continue-first-recursion-with-2-from-third-recursion">
       Continue First Recursion with
       <code class="language-plaintext highlighter-rouge">
        2
       </code>
       from Third Recursion
      </h3>
      <ul>
       <li>
        After replacing
        <code class="language-plaintext highlighter-rouge">
         "(1 + 1)"
        </code>
        with
        <code class="language-plaintext highlighter-rouge">
         2
        </code>
        , the expression becomes
        <code class="language-plaintext highlighter-rouge">
         "2 - 5 * 4 / 2"
        </code>
        .
       </li>
       <li>
        Continue parsing:
        <code class="language-plaintext highlighter-rouge">
         "/ 2"
        </code>
        updates
        <code class="language-plaintext highlighter-rouge">
         op
        </code>
        to
        <code class="language-plaintext highlighter-rouge">
         "/"
        </code>
        and sets
        <code class="language-plaintext highlighter-rouge">
         num = 2
        </code>
        .
       </li>
       <li>
        Perform the multiplication and division with the stack:
        <code class="language-plaintext highlighter-rouge">
         2 - (5 * 4) / 2 = 2 - 10 = -8
        </code>
        .
       </li>
       <li>
        Return
        <code class="language-plaintext highlighter-rouge">
         -8
        </code>
        to the initial level of calculation.
       </li>
      </ul>
      <h3 id="final-steps">
       Final Steps
      </h3>
      <ul>
       <li>
        Replace the original sub-expression with
        <code class="language-plaintext highlighter-rouge">
         -8
        </code>
        , making the initial expression
        <code class="language-plaintext highlighter-rouge">
         "1 + -8 * 2"
        </code>
        .
       </li>
       <li>
        Calculate the final result:
        <code class="language-plaintext highlighter-rouge">
         1 + (-8 * 2) = 1 - 16 = -15
        </code>
        .
       </li>
      </ul>
      <ul class="uk-tab" data-uk-switcher="{connect:'#952bd13e-0ab0-4493-9e99-e121aff18ba6'}">
       <li class="uk-active">
        <a href="solution-772.html">
         Java
        </a>
       </li>
       <li>
        <a href="solution-772.html">
         C++
        </a>
       </li>
       <li>
        <a href="solution-772.html">
         Python
        </a>
       </li>
      </ul>
      <ul class="uk-switcher uk-margin" id="952bd13e-0ab0-4493-9e99-e121aff18ba6">
       <li>
        <div class="language-java highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Basic_Calculator_III</span> <span class="o">{</span>


    <span class="c1">// ref: http://buttercola.blogspot.com/2019/03/leetcode-772-basic-calculator-iii.html</span>
    <span class="kd">class</span> <span class="nc">Solution</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calculate</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// remove leading and trailing spaces and white spaces.</span>
            <span class="c1">//</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"[ ]+"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nc">Stack</span><span class="o">&lt;</span><span class="nc">Character</span><span class="o">&gt;</span> <span class="n">opStack</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Stack</span><span class="o">&lt;&gt;();</span>
            <span class="nc">Stack</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">numStack</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Stack</span><span class="o">&lt;&gt;();</span>

            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">Character</span><span class="o">.</span><span class="na">isDigit</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">)))</span> <span class="o">{</span>
                    <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                    <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="nc">Character</span><span class="o">.</span><span class="na">isDigit</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">)))</span> <span class="o">{</span>
                        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="nc">Character</span><span class="o">.</span><span class="na">getNumericValue</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                        <span class="n">i</span><span class="o">++;</span>
                    <span class="o">}</span>
                    <span class="n">numStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">op</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">opStack</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                        <span class="n">opStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">op</span><span class="o">);</span>
                        <span class="n">i</span><span class="o">++;</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">'+'</span> <span class="o">||</span> <span class="n">op</span> <span class="o">==</span> <span class="sc">'-'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="kt">char</span> <span class="n">top</span> <span class="o">=</span> <span class="n">opStack</span><span class="o">.</span><span class="na">peek</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">top</span> <span class="o">==</span> <span class="sc">'('</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">opStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">op</span><span class="o">);</span>
                            <span class="n">i</span><span class="o">++;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="n">calculate</span><span class="o">(</span><span class="n">numStack</span><span class="o">,</span> <span class="n">opStack</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">'*'</span> <span class="o">||</span> <span class="n">op</span> <span class="o">==</span> <span class="sc">'/'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="kt">char</span> <span class="n">top</span> <span class="o">=</span> <span class="n">opStack</span><span class="o">.</span><span class="na">peek</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">top</span> <span class="o">==</span> <span class="sc">'('</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">opStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">op</span><span class="o">);</span>
                            <span class="n">i</span><span class="o">++;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">top</span> <span class="o">==</span> <span class="sc">'*'</span> <span class="o">||</span> <span class="n">top</span> <span class="o">==</span> <span class="sc">'/'</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">calculate</span><span class="o">(</span><span class="n">numStack</span><span class="o">,</span> <span class="n">opStack</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">top</span> <span class="o">==</span> <span class="sc">'+'</span> <span class="o">||</span> <span class="n">top</span> <span class="o">==</span> <span class="sc">'-'</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">opStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">op</span><span class="o">);</span>
                            <span class="n">i</span><span class="o">++;</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">'('</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">opStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">op</span><span class="o">);</span>
                        <span class="n">i</span><span class="o">++;</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">')'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">while</span> <span class="o">(</span><span class="n">opStack</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">!=</span> <span class="sc">'('</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">calculate</span><span class="o">(</span><span class="n">numStack</span><span class="o">,</span> <span class="n">opStack</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="n">opStack</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
                        <span class="n">i</span><span class="o">++;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="k">while</span> <span class="o">(!</span><span class="n">opStack</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">calculate</span><span class="o">(</span><span class="n">numStack</span><span class="o">,</span> <span class="n">opStack</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">numStack</span><span class="o">.</span><span class="na">peek</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">calculate</span><span class="o">(</span><span class="nc">Stack</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">numStack</span><span class="o">,</span> <span class="nc">Stack</span><span class="o">&lt;</span><span class="nc">Character</span><span class="o">&gt;</span> <span class="n">opStack</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">num2</span> <span class="o">=</span> <span class="n">numStack</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">num1</span> <span class="o">=</span> <span class="n">numStack</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>

            <span class="kt">char</span> <span class="n">op</span> <span class="o">=</span> <span class="n">opStack</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>

            <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

            <span class="k">switch</span><span class="o">(</span><span class="n">op</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="sc">'+'</span><span class="o">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="o">;</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="sc">'-'</span><span class="o">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="o">;</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="sc">'*'</span><span class="o">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="o">;</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">case</span> <span class="sc">'/'</span><span class="o">:</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span><span class="o">;</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">numStack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">ans</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-cpp highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="c1">// OJ: https://leetcode.com/problems/basic-calculator-iii/</span>
<span class="c1">// Time: O(N)</span>
<span class="c1">// Space: O(N)</span>
<span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
    <span class="n">stack</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">num</span><span class="p">;</span>
    <span class="n">stack</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">op</span><span class="p">;</span>
    <span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">priority</span><span class="p">{</span> <span class="p">{</span><span class="sc">'+'</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="sc">'-'</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="sc">'*'</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="sc">'/'</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span> <span class="p">};</span>
    <span class="kt">void</span> <span class="n">eval</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">b</span> <span class="o">=</span> <span class="n">num</span><span class="p">.</span><span class="n">top</span><span class="p">();</span> <span class="n">num</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">op</span><span class="p">.</span><span class="n">top</span><span class="p">();</span> <span class="n">op</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="sc">'+'</span><span class="p">:</span> <span class="n">num</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">'-'</span><span class="p">:</span> <span class="n">num</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">'*'</span><span class="p">:</span> <span class="n">num</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">*=</span> <span class="n">b</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">'/'</span><span class="p">:</span> <span class="n">num</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">/=</span> <span class="n">b</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="nl">public:</span>
    <span class="kt">int</span> <span class="n">calculate</span><span class="p">(</span><span class="n">string</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">' '</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
                <span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">&amp;&amp;</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">;</span>
                <span class="o">--</span><span class="n">i</span><span class="p">;</span>
                <span class="n">num</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'('</span><span class="p">)</span> <span class="n">op</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">')'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">op</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'('</span><span class="p">)</span> <span class="n">eval</span><span class="p">();</span>
                <span class="n">op</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">op</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">op</span><span class="p">.</span><span class="n">top</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'('</span> <span class="o">&amp;&amp;</span> <span class="n">priority</span><span class="p">[</span><span class="n">op</span><span class="p">.</span><span class="n">top</span><span class="p">()]</span> <span class="o">&gt;=</span> <span class="n">priority</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="n">eval</span><span class="p">();</span>
                <span class="n">op</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">op</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="n">eval</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">num</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-python highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="c1"># good one, based on solution of Basic Calculator II
</span><span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span> <span class="c1"># dfs recursion
</span>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">op</span> <span class="o">=</span> <span class="s">"+"</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">"("</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">findClosing</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="p">])</span> <span class="c1"># j is ')'
</span>                <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="c1"># out if, i will +1 below
</span>            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">"+-*/"</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s">"+"</span><span class="p">:</span>
                    <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">"-"</span><span class="p">:</span>
                    <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">num</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">"*"</span><span class="p">:</span>
                    <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">num</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">num</span><span class="p">)</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">c</span>
                <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">findClosing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">"("</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">")"</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">i</span>


<span class="c1">##############
</span>

<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span> <span class="c1"># iterative
</span>    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">evaluate_expression</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">if</span> <span class="n">stack</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="c1"># Evaluate the expression till we get '(' or empty stack
</span>            <span class="k">while</span> <span class="n">stack</span> <span class="ow">and</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'('</span><span class="p">:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">'+'</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">-=</span> <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">'*'</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">*=</span> <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s">'/'</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">//=</span> <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">res</span>

        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># mix of num and operator
</span>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="c1"># Get the complete number and push it to the stack
</span>                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="s">'+-*/('</span><span class="p">:</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">')'</span><span class="p">:</span>
                <span class="c1"># Evaluate the expression within the parentheses
</span>                <span class="n">res</span> <span class="o">=</span> <span class="n">evaluate_expression</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># Remove the opening '('
</span>                <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">evaluate_expression</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>


<span class="c1">###############
</span>
<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># remove leading and trailing spaces and white spaces.
</span>        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">op_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num_stack</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">op_stack</span><span class="p">:</span>
                    <span class="n">op_stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'+'</span> <span class="ow">or</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span>
                    <span class="n">top</span> <span class="o">=</span> <span class="n">op_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">top</span> <span class="o">==</span> <span class="s">'('</span><span class="p">:</span>
                        <span class="n">op_stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">calculate_helper</span><span class="p">(</span><span class="n">num_stack</span><span class="p">,</span> <span class="n">op_stack</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'*'</span> <span class="ow">or</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'/'</span><span class="p">:</span>
                    <span class="n">top</span> <span class="o">=</span> <span class="n">op_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">top</span> <span class="o">==</span> <span class="s">'('</span> <span class="ow">or</span> <span class="n">top</span> <span class="o">==</span> <span class="s">'+'</span> <span class="ow">or</span> <span class="n">top</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span>
                        <span class="n">op_stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">calculate_helper</span><span class="p">(</span><span class="n">num_stack</span><span class="p">,</span> <span class="n">op_stack</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'('</span><span class="p">:</span>
                    <span class="n">op_stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">')'</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">op_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'('</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">calculate_helper</span><span class="p">(</span><span class="n">num_stack</span><span class="p">,</span> <span class="n">op_stack</span><span class="p">)</span>
                    <span class="n">op_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">op_stack</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">calculate_helper</span><span class="p">(</span><span class="n">num_stack</span><span class="p">,</span> <span class="n">op_stack</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">num_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">calculate_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_stack</span><span class="p">,</span> <span class="n">op_stack</span><span class="p">):</span>
        <span class="n">num2</span> <span class="o">=</span> <span class="n">num_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">num1</span> <span class="o">=</span> <span class="n">num_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">op</span> <span class="o">=</span> <span class="n">op_stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'+'</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">'*'</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num1</span> <span class="o">/</span> <span class="n">num2</span><span class="p">)</span>

        <span class="n">num_stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>

</code></pre>
         </div>
        </div>
       </li>
      </ul>
      
     </article>
     
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-772.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
