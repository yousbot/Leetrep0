<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-480.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-480.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>480 - Sliding Window Median</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode Formatted question description: https://leetcode.ca/all/480.html 480. Sliding Window Median Level Hard Description Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value....">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-480.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-480.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-480.html" rel="stylesheet"/>
   <link href="solution-480.html" rel="stylesheet"/>
   <link href="solution-480.html" rel="stylesheet"/>
   <link href="solution-480.html" rel="stylesheet"/>
   <link href="solution-480.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="480 - Sliding Window Median" property="og:title"/>
   <meta content="Leetcode Formatted question description: https://leetcode.ca/all/480.html 480. Sliding Window Median Level Hard Description Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value. Examples: [2,3,4], the median is 3 [2,3], the median is (2 + 3) / 2 = 2.5 Given an array nums, there is a sliding window of size k which is moving from the very left of the array to the very right. You can only see the k numbers in the window. Each time the sliding window moves right by one position. Your job is to output the median array for each window in the original array. For example, Given nums = [1,3,-1,-3,5,3,6,7], and k = 3. Window position Median --------------- ----- [1 3 -1] -3 5 3 6 7 1 1 [3 -1 -3] 5 3 6 7 -1 1 3 [-1 -3 5] 3 6 7 -1 1 3 -1 [-3 5 3] 6 7 3 1 3 -1 -3 [5 3 6] 7 5 1 3 -1 -3 5 [3 6 7] 6 Therefore, return the median sliding window as [1,-1,-1,3,5,6]. Note: You may assume k is always valid, ie: k is always smaller than input arrayâs size for non-empty array. Answers within 10^-5 of the actual value will be accepted as correct. Solution Solution 1 - Two heaps Use two priority queues to store the smaller half elements and the larger half elements respectively. The first priority queue priorityQueue1 stores the smaller half elements and the largest element is polled first. The second priority queue priorityQueue2 stores the larger half elements and the smallest element is polled first. If there are odd number of elements, then priorityQueue1 stores one more element than priorityQueue2. The median is calculated in a straightforward way. If k is odd, then peek one element from priorityQueue1, which is the median. If k is even, then peek one element from each queue priorityQueue1 and priorityQueue2 respectively and calculate the mean of the two peeked elements, which is the median. Since this problem requires calculating the median array for each window, polling elements and offering elements frequently is not efficient. A better way is to use a map to store the invalid elements and the number of occurrences of each invalid element. Each time obtain the previous element in the window that is not in the window any longer and update its number of occurrences in the map. After the previous element and the new element are obtained, check which priority queues the two elements should be in, comparing the two elements with the elements at the top of both priority queues. Then add the new element to the correct priority queue. Then for both priority queues, while the element at the top of each priority queue is in the map of invalid elements, poll them out and update the map. Then..." property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2017-03-24T22:21:01-07:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2017-03-24-480-Sliding-Window-Median/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-480.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="480 - Sliding Window Median" property="twitter:title"/>
   <meta content="Leetcode Formatted question description: https://leetcode.ca/all/480.html 480. Sliding Window Median Level Hard Description Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value. Examples: [2,3,4], the median is 3 [2,3], the median is (2 + 3) / 2 = 2.5 Given an array nums, there is a sliding window of size k which is moving from the very left of the array to the very right. You can only see the k numbers in the window. Each time the sliding window moves right by one position. Your job is to output the median array for each window in the original array. For example, Given nums = [1,3,-1,-3,5,3,6,7], and k = 3. Window position Median --------------- ----- [1 3 -1] -3 5 3 6 7 1 1 [3 -1 -3] 5 3 6 7 -1 1 3 [-1 -3 5] 3 6 7 -1 1 3 -1 [-3 5 3] 6 7 3 1 3 -1 -3 [5 3 6] 7 5 1 3 -1 -3 5 [3 6 7] 6 Therefore, return the median sliding window as [1,-1,-1,3,5,6]. Note: You may assume k is always valid, ie: k is always smaller than input arrayâs size for non-empty array. Answers within 10^-5 of the actual value will be accepted as correct. Solution Solution 1 - Two heaps Use two priority queues to store the smaller half elements and the larger half elements respectively. The first priority queue priorityQueue1 stores the smaller half elements and the largest element is polled first. The second priority queue priorityQueue2 stores the larger half elements and the smallest element is polled first. If there are odd number of elements, then priorityQueue1 stores one more element than priorityQueue2. The median is calculated in a straightforward way. If k is odd, then peek one element from priorityQueue1, which is the median. If k is even, then peek one element from each queue priorityQueue1 and priorityQueue2 respectively and calculate the mean of the two peeked elements, which is the median. Since this problem requires calculating the median array for each window, polling elements and offering elements frequently is not efficient. A better way is to use a map to store the invalid elements and the number of occurrences of each invalid element. Each time obtain the previous element in the window that is not in the window any longer and update its number of occurrences in the map. After the previous element and the new element are obtained, check which priority queues the two elements should be in, comparing the two elements with the elements at the top of both priority queues. Then add the new element to the correct priority queue. Then for both priority queues, while the element at the top of each priority queue is in the map of invalid elements, poll them out and update the map. Then..." property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    480 - Sliding Window Median | Leetcode
   </title>
   <meta content="Jekyll v3.10.0" name="generator">
    <meta content="480 - Sliding Window Median" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-480.html" rel="canonical">
          <meta content="https://leetcode.ca/2017-03-24-480-Sliding-Window-Median/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2017-03-24T22:21:01-07:00" property="article:published_time">
              <script type="application/ld+json">
               {"description":"Leetcode","headline":"480 - Sliding Window Median","dateModified":"2017-03-24T22:21:01-07:00","datePublished":"2017-03-24T22:21:01-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2017-03-24-480-Sliding-Window-Median/"},"url":"https://leetcode.ca/2017-03-24-480-Sliding-Window-Median/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCslk3mmaMJy1enit3L9vWig" data-count="hidden" data-layout="full">
      </div>
      <p>
       Formatted question description:
       <a href="solution-480.html">
        https://leetcode.ca/all/480.html
       </a>
      </p>
      <h1 id="480-sliding-window-median">
       480. Sliding Window Median
      </h1>
      <h2 id="level">
       Level
      </h2>
      <p>
       Hard
      </p>
      <h2 id="description">
       Description
      </h2>
      <p>
       Median is the middle value in an ordered integer list. If the size of the list is even, there is no middle value. So the median is the mean of the two middle value.
      </p>
      <p>
       Examples:
      </p>
      <p>
       <code class="language-plaintext highlighter-rouge">
        [2,3,4]
       </code>
       , the median is
       <code class="language-plaintext highlighter-rouge">
        3
       </code>
      </p>
      <p>
       <code class="language-plaintext highlighter-rouge">
        [2,3]
       </code>
       , the median is
       <code class="language-plaintext highlighter-rouge">
        (2 + 3) / 2 = 2.5
       </code>
      </p>
      <p>
       Given an array
       <em>
        nums
       </em>
       , there is a sliding window of size
       <em>
        k
       </em>
       which is moving from the very left of the array to the very right. You can only see the
       <em>
        k
       </em>
       numbers in the window. Each time the sliding window moves right by one position. Your job is to output the median array for each window in the original array.
      </p>
      <p>
       For example,
      </p>
      <p>
       Given
       <em>
        nums
       </em>
       =
       <code class="language-plaintext highlighter-rouge">
        [1,3,-1,-3,5,3,6,7]
       </code>
       , and
       <em>
        k
       </em>
       = 3.
      </p>
      <div class="language-plaintext highlighter-rouge">
       <div class="highlight">
        <pre class="highlight"><code>Window position                Median
---------------               -----
[1  3  -1] -3  5  3  6  7       1
 1 [3  -1  -3] 5  3  6  7       -1
 1  3 [-1  -3  5] 3  6  7       -1
 1  3  -1 [-3  5  3] 6  7       3
 1  3  -1  -3 [5  3  6] 7       5
 1  3  -1  -3  5 [3  6  7]      6
</code></pre>
       </div>
      </div>
      <p>
       Therefore, return the median sliding window as [1,-1,-1,3,5,6].
      </p>
      <p>
       <strong>
        Note:
       </strong>
      </p>
      <p>
       You may assume
       <code class="language-plaintext highlighter-rouge">
        k
       </code>
       is always valid, ie:
       <code class="language-plaintext highlighter-rouge">
        k
       </code>
       is always smaller than input arrayâs size for non-empty array.
      </p>
      <p>
       Answers within
       <code class="language-plaintext highlighter-rouge">
        10^-5
       </code>
       of the actual value will be accepted as correct.
      </p>
      <h2 id="solution">
       Solution
      </h2>
      <h3 id="solution-1---two-heaps">
       Solution 1 - Two heaps
      </h3>
      <p>
       Use two priority queues to store the smaller half elements and the larger half elements respectively. The first priority queue
       <code class="language-plaintext highlighter-rouge">
        priorityQueue1
       </code>
       stores the smaller half elements and the largest element is polled first. The second priority queue
       <code class="language-plaintext highlighter-rouge">
        priorityQueue2
       </code>
       stores the larger half elements and the smallest element is polled first. If there are odd number of elements, then
       <code class="language-plaintext highlighter-rouge">
        priorityQueue1
       </code>
       stores one more element than
       <code class="language-plaintext highlighter-rouge">
        priorityQueue2
       </code>
       .
      </p>
      <p>
       The median is calculated in a straightforward way. If
       <code class="language-plaintext highlighter-rouge">
        k
       </code>
       is odd, then peek one element from
       <code class="language-plaintext highlighter-rouge">
        priorityQueue1
       </code>
       , which is the median. If
       <code class="language-plaintext highlighter-rouge">
        k
       </code>
       is even, then peek one element from each queue
       <code class="language-plaintext highlighter-rouge">
        priorityQueue1
       </code>
       and
       <code class="language-plaintext highlighter-rouge">
        priorityQueue2
       </code>
       respectively and calculate the mean of the two peeked elements, which is the median.
      </p>
      <p>
       Since this problem requires calculating the median array for each window, polling elements and offering elements frequently is not efficient. A better way is to use a map to store the invalid elements and the number of occurrences of each invalid element. Each time obtain the previous element in the window that is not in the window any longer and update its number of occurrences in the map. After the previous element and the new element are obtained, check which priority queues the two elements should be in, comparing the two elements with the elements at the top of both priority queues. Then add the new element to the correct priority queue. Then for both priority queues, while the element at the top of each priority queue is in the map of invalid elements, poll them out and update the map. Then calculate the median accordingly.
      </p>
      <h1 id="solution-2---sorted-list-k">
       Solution 2 - Sorted list-k
      </h1>
      <p>
       We first add the first
       <code class="language-plaintext highlighter-rouge">
        k
       </code>
       arrays of the array to the set. Since
       <code class="language-plaintext highlighter-rouge">
        multiset
       </code>
       has its own sorting function, we can quickly find the iterator
       <code class="language-plaintext highlighter-rouge">
        mid
       </code>
       pointing to the middle number through
       <code class="language-plaintext highlighter-rouge">
        k/2
       </code>
       .
      </p>
      <ul>
       <li>
        If k is an
        <code class="language-plaintext highlighter-rouge">
         odd
        </code>
        number, then the number pointed to by
        <code class="language-plaintext highlighter-rouge">
         mid
        </code>
        which is the median;
       </li>
       <li>
        if k is an
        <code class="language-plaintext highlighter-rouge">
         even
        </code>
        number, then the average of the number pointed to by mid and the previous number is the median.
       </li>
      </ul>
      <p>
       When we add a new number to the collection, the
       <code class="language-plaintext highlighter-rouge">
        multiset
       </code>
       will be added to the correct position according to the size of the new number, and then we see that
      </p>
      <ul>
       <li>
        if the newly added number is
        <code class="language-plaintext highlighter-rouge">
         smaller
        </code>
        than the number pointed to by the previous
        <code class="language-plaintext highlighter-rouge">
         mid
        </code>
        , then the median must be pulled down , so
        <code class="language-plaintext highlighter-rouge">
         mid
        </code>
        moves
        <code class="language-plaintext highlighter-rouge">
         forward by one
        </code>
        ,
       </li>
       <li>
        and if the number to be deleted is less than or equal to the number pointed to by
        <code class="language-plaintext highlighter-rouge">
         mid
        </code>
        (note that the equal sign is added here because the number to be deleted may be the number pointed to by
        <code class="language-plaintext highlighter-rouge">
         mid
        </code>
        ), then
        <code class="language-plaintext highlighter-rouge">
         mid
        </code>
        moves
        <code class="language-plaintext highlighter-rouge">
         backward by one
        </code>
        .
       </li>
      </ul>
      <p>
       Then we delete the leftmost number of the sliding window.
      </p>
      <ul class="uk-tab" data-uk-switcher="{connect:'#da4bf4c4-c7f3-40c5-bfc5-aa8e26abfa97'}">
       <li class="uk-active">
        <a href="solution-480.html">
         Java
        </a>
       </li>
       <li>
        <a href="solution-480.html">
         C++
        </a>
       </li>
       <li>
        <a href="solution-480.html">
         Python
        </a>
       </li>
       <li>
        <a href="solution-480.html">
         Go
        </a>
       </li>
      </ul>
      <ul class="uk-switcher uk-margin" id="da4bf4c4-c7f3-40c5-bfc5-aa8e26abfa97">
       <li>
        <div class="language-java highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kd">class</span> <span class="nc">MedianFinder</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">small</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriorityQueue</span><span class="o">&lt;&gt;(</span><span class="nc">Comparator</span><span class="o">.</span><span class="na">reverseOrder</span><span class="o">());</span>
    <span class="kd">private</span> <span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">large</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriorityQueue</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">delayed</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">smallSize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">largeSize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">k</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MedianFinder</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addNum</span><span class="o">(</span><span class="kt">int</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">small</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">||</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="n">small</span><span class="o">.</span><span class="na">peek</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">small</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="o">++</span><span class="n">smallSize</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">large</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
            <span class="o">++</span><span class="n">largeSize</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">rebalance</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">findMedian</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">small</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">:</span> <span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="n">small</span><span class="o">.</span><span class="na">peek</span><span class="o">()</span> <span class="o">+</span> <span class="n">large</span><span class="o">.</span><span class="na">peek</span><span class="o">())</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeNum</span><span class="o">(</span><span class="kt">int</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">delayed</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">num</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">num</span> <span class="o">&lt;=</span> <span class="n">small</span><span class="o">.</span><span class="na">peek</span><span class="o">())</span> <span class="o">{</span>
            <span class="o">--</span><span class="n">smallSize</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">num</span> <span class="o">==</span> <span class="n">small</span><span class="o">.</span><span class="na">peek</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">prune</span><span class="o">(</span><span class="n">small</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="o">--</span><span class="n">largeSize</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">num</span> <span class="o">==</span> <span class="n">large</span><span class="o">.</span><span class="na">peek</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">prune</span><span class="o">(</span><span class="n">large</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">rebalance</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">prune</span><span class="o">(</span><span class="nc">PriorityQueue</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">pq</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">pq</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">delayed</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">pq</span><span class="o">.</span><span class="na">peek</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">delayed</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">pq</span><span class="o">.</span><span class="na">peek</span><span class="o">(),</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">delayed</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">pq</span><span class="o">.</span><span class="na">peek</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">pq</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">rebalance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">smallSize</span> <span class="o">&gt;</span> <span class="n">largeSize</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">large</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">small</span><span class="o">.</span><span class="na">poll</span><span class="o">());</span>
            <span class="o">--</span><span class="n">smallSize</span><span class="o">;</span>
            <span class="o">++</span><span class="n">largeSize</span><span class="o">;</span>
            <span class="n">prune</span><span class="o">(</span><span class="n">small</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">smallSize</span> <span class="o">&lt;</span> <span class="n">largeSize</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">small</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">large</span><span class="o">.</span><span class="na">poll</span><span class="o">());</span>
            <span class="o">--</span><span class="n">largeSize</span><span class="o">;</span>
            <span class="o">++</span><span class="n">smallSize</span><span class="o">;</span>
            <span class="n">prune</span><span class="o">(</span><span class="n">large</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">Solution</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">double</span><span class="o">[]</span> <span class="nf">medianSlidingWindow</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">nums</span><span class="o">,</span> <span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">MedianFinder</span> <span class="n">finder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MedianFinder</span><span class="o">(</span><span class="n">k</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">finder</span><span class="o">.</span><span class="na">addNum</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">nums</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="kt">double</span><span class="o">[]</span> <span class="n">ans</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="o">];</span>
        <span class="n">ans</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="na">findMedian</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">finder</span><span class="o">.</span><span class="na">addNum</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
            <span class="n">finder</span><span class="o">.</span><span class="na">removeNum</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="o">]);</span>
            <span class="n">ans</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="na">findMedian</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-cpp highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">medianSlidingWindow</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">nums</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">;</span>
        <span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">small</span><span class="p">,</span> <span class="n">large</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">small</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">]))</span> <span class="n">small</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">small</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">]));</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">large</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">]))</span> <span class="n">large</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">large</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">k</span><span class="p">]));</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">small</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">large</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">large</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">*</span><span class="n">large</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span> <span class="n">small</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">small</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">*</span><span class="n">large</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
                    <span class="n">large</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">large</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
                    <span class="n">large</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">*</span><span class="n">small</span><span class="p">.</span><span class="n">rbegin</span><span class="p">())</span> <span class="n">large</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">large</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">*</span><span class="n">small</span><span class="p">.</span><span class="n">rbegin</span><span class="p">());</span>
                    <span class="n">small</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">--</span><span class="n">small</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
                    <span class="n">small</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">small</span><span class="p">.</span><span class="n">rbegin</span><span class="p">());</span>
                <span class="k">else</span> <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">small</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()</span> <span class="o">+</span> <span class="o">*</span><span class="n">large</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-python highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="s">'''
&gt;&gt;&gt; nums = [1,3,-1,-3,5,3,6,7]
&gt;&gt;&gt; k = 3
&gt;&gt;&gt; window = sorted(nums[:k])
&gt;&gt;&gt; window
[-1, 1, 3]
&gt;&gt;&gt;
&gt;&gt;&gt; nums[k:] + [0]
[-3, 5, 3, 6, 7, 0]
&gt;&gt;&gt; zip(nums, nums[k:] + [0])
&lt;zip object at 0x108f384c0&gt;
&gt;&gt;&gt; list(zip(nums, nums[k:] + [0]))
[(1, -3), (3, 5), (-1, 3), (-3, 6), (5, 7), (3, 0)]
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; window.remove(1)
&gt;&gt;&gt; window
[-1, 3]

&gt;&gt;&gt; bisect.insort(window, -3)
&gt;&gt;&gt; window
[-3, -1, 3]
'''</span>

<span class="s">'''
&gt;&gt;&gt; nums
[1, 3, -1, -3, 5, 3, 6, 7]
&gt;&gt;&gt;
&gt;&gt;&gt; nums[1]
3
&gt;&gt;&gt; nums[~1]
6
'''</span>
<span class="kn">import</span> <span class="nn">bisect</span>

<span class="k">class</span> <span class="nc">Solution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">medianSlidingWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="c1"># this solution is just the natural flow
</span>    <span class="n">window</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nums</span><span class="p">[:</span><span class="n">k</span><span class="p">])</span>
    <span class="n">medians</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">nums</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># +[0] to keep the loop running
</span>    <span class="c1"># e.g. k=3 and nums[1,2,3], so it should enter the loop for one time
</span>      <span class="n">medians</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">window</span><span class="p">[</span><span class="n">k</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">window</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">k</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
      <span class="n">window</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
      <span class="n">bisect</span><span class="p">.</span><span class="n">insort</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">medians</span>

<span class="c1">###########
</span>
<span class="c1"># heap solution
# Since we are using k-size heap here, the time complexity is O(nlogk) 
#   and space complexity is O(logk).
</span><span class="k">def</span> <span class="nf">medianSlidingWindow</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
	<span class="n">small</span><span class="p">,</span> <span class="n">large</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nums</span><span class="p">[:</span><span class="n">k</span><span class="p">]):</span>
		<span class="n">heapq</span><span class="p">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)):</span>
		<span class="n">move</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">large</span><span class="p">)</span>
	<span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_med</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">large</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">k</span><span class="p">:]):</span>
		<span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">large</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
			<span class="n">heapq</span><span class="p">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">large</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">large</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
				<span class="n">move</span><span class="p">(</span><span class="n">large</span><span class="p">,</span> <span class="n">small</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">heapq</span><span class="p">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">large</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
				<span class="n">move</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">large</span><span class="p">)</span>
		<span class="k">while</span> <span class="n">small</span> <span class="ow">and</span> <span class="n">small</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
			<span class="n">heapq</span><span class="p">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
		<span class="k">while</span> <span class="n">large</span> <span class="ow">and</span> <span class="n">large</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
			<span class="n">heapq</span><span class="p">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">large</span><span class="p">)</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_med</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">large</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">ans</span>

<span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">):</span>
	<span class="n">x</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">heapq</span><span class="p">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>
	<span class="n">heapq</span><span class="p">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_med</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">h2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">h2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>

</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-go highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="k">type</span> <span class="n">MedianFinder</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">small</span>                <span class="n">hp</span>
	<span class="n">large</span>                <span class="n">hp</span>
	<span class="n">delayed</span>              <span class="k">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span>
	<span class="n">smallSize</span><span class="p">,</span> <span class="n">largeSize</span> <span class="kt">int</span>
	<span class="n">k</span>                    <span class="kt">int</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Constructor</span><span class="p">(</span><span class="n">k</span> <span class="kt">int</span><span class="p">)</span> <span class="n">MedianFinder</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">MedianFinder</span><span class="p">{</span><span class="n">hp</span><span class="p">{},</span> <span class="n">hp</span><span class="p">{},</span> <span class="k">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">{},</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">k</span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">this</span> <span class="o">*</span><span class="n">MedianFinder</span><span class="p">)</span> <span class="n">AddNum</span><span class="p">(</span><span class="n">num</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">Len</span><span class="p">()</span> <span class="o">==</span> <span class="m">0</span> <span class="o">||</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">{</span>
		<span class="n">heap</span><span class="o">.</span><span class="n">Push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="p">,</span> <span class="o">-</span><span class="n">num</span><span class="p">)</span>
		<span class="n">this</span><span class="o">.</span><span class="n">smallSize</span><span class="o">++</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">heap</span><span class="o">.</span><span class="n">Push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
		<span class="n">this</span><span class="o">.</span><span class="n">largeSize</span><span class="o">++</span>
	<span class="p">}</span>
	<span class="n">this</span><span class="o">.</span><span class="n">rebalance</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">this</span> <span class="o">*</span><span class="n">MedianFinder</span><span class="p">)</span> <span class="n">FindMedian</span><span class="p">()</span> <span class="kt">float64</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">this</span><span class="o">.</span><span class="n">k</span><span class="o">&amp;</span><span class="m">1</span> <span class="o">==</span> <span class="m">1</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kt">float64</span><span class="p">(</span><span class="o">-</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">])</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kt">float64</span><span class="p">(</span><span class="o">-</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">+</span><span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">])</span> <span class="o">/</span> <span class="m">2</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">this</span> <span class="o">*</span><span class="n">MedianFinder</span><span class="p">)</span> <span class="n">removeNum</span><span class="p">(</span><span class="n">num</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">this</span><span class="o">.</span><span class="n">delayed</span><span class="p">[</span><span class="n">num</span><span class="p">]</span><span class="o">++</span>
	<span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">{</span>
		<span class="n">this</span><span class="o">.</span><span class="n">smallSize</span><span class="o">--</span>
		<span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="o">-</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">{</span>
			<span class="n">this</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">this</span><span class="o">.</span><span class="n">largeSize</span><span class="o">--</span>
		<span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">{</span>
			<span class="n">this</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">this</span><span class="o">.</span><span class="n">rebalance</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">this</span> <span class="o">*</span><span class="n">MedianFinder</span><span class="p">)</span> <span class="n">prune</span><span class="p">(</span><span class="n">pq</span> <span class="o">*</span><span class="n">hp</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">sign</span> <span class="o">:=</span> <span class="m">1</span>
	<span class="k">if</span> <span class="n">pq</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">small</span> <span class="p">{</span>
		<span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">pq</span><span class="o">.</span><span class="n">Len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> <span class="n">this</span><span class="o">.</span><span class="n">delayed</span><span class="p">[</span><span class="n">sign</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">this</span><span class="o">.</span><span class="n">delayed</span><span class="p">[</span><span class="n">sign</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]]</span><span class="o">--</span>
		<span class="k">if</span> <span class="n">this</span><span class="o">.</span><span class="n">delayed</span><span class="p">[</span><span class="n">sign</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">]]</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
			<span class="nb">delete</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">delayed</span><span class="p">,</span> <span class="n">sign</span><span class="o">*</span><span class="n">pq</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="m">0</span><span class="p">])</span>
		<span class="p">}</span>
		<span class="n">heap</span><span class="o">.</span><span class="n">Pop</span><span class="p">(</span><span class="n">pq</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">this</span> <span class="o">*</span><span class="n">MedianFinder</span><span class="p">)</span> <span class="n">rebalance</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">if</span> <span class="n">this</span><span class="o">.</span><span class="n">smallSize</span> <span class="o">&gt;</span> <span class="n">this</span><span class="o">.</span><span class="n">largeSize</span><span class="o">+</span><span class="m">1</span> <span class="p">{</span>
		<span class="n">heap</span><span class="o">.</span><span class="n">Push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="p">,</span> <span class="o">-</span><span class="n">heap</span><span class="o">.</span><span class="n">Pop</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">))</span>
		<span class="n">this</span><span class="o">.</span><span class="n">smallSize</span><span class="o">--</span>
		<span class="n">this</span><span class="o">.</span><span class="n">largeSize</span><span class="o">++</span>
		<span class="n">this</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">this</span><span class="o">.</span><span class="n">smallSize</span> <span class="o">&lt;</span> <span class="n">this</span><span class="o">.</span><span class="n">largeSize</span> <span class="p">{</span>
		<span class="n">heap</span><span class="o">.</span><span class="n">Push</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">small</span><span class="p">,</span> <span class="o">-</span><span class="n">heap</span><span class="o">.</span><span class="n">Pop</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">))</span>
		<span class="n">this</span><span class="o">.</span><span class="n">smallSize</span><span class="o">++</span>
		<span class="n">this</span><span class="o">.</span><span class="n">largeSize</span><span class="o">--</span>
		<span class="n">this</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="o">&amp;</span><span class="n">this</span><span class="o">.</span><span class="n">large</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">medianSlidingWindow</span><span class="p">(</span><span class="n">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="n">k</span> <span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">float64</span> <span class="p">{</span>
	<span class="n">finder</span> <span class="o">:=</span> <span class="n">Constructor</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">num</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">nums</span><span class="p">[</span><span class="o">:</span><span class="n">k</span><span class="p">]</span> <span class="p">{</span>
		<span class="n">finder</span><span class="o">.</span><span class="n">AddNum</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">ans</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="n">finder</span><span class="o">.</span><span class="n">FindMedian</span><span class="p">()}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">finder</span><span class="o">.</span><span class="n">AddNum</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">finder</span><span class="o">.</span><span class="n">removeNum</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">])</span>
		<span class="n">ans</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">finder</span><span class="o">.</span><span class="n">FindMedian</span><span class="p">())</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">hp</span> <span class="k">struct</span><span class="p">{</span> <span class="n">sort</span><span class="o">.</span><span class="n">IntSlice</span> <span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="n">hp</span><span class="p">)</span> <span class="n">Less</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span>  <span class="p">{</span> <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">h</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">hp</span><span class="p">)</span> <span class="n">Push</span><span class="p">(</span><span class="n">v</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span> <span class="n">h</span><span class="o">.</span><span class="n">IntSlice</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">IntSlice</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">))</span> <span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">hp</span><span class="p">)</span> <span class="n">Pop</span><span class="p">()</span> <span class="k">interface</span><span class="p">{}</span> <span class="p">{</span>
	<span class="n">a</span> <span class="o">:=</span> <span class="n">h</span><span class="o">.</span><span class="n">IntSlice</span>
	<span class="n">v</span> <span class="o">:=</span> <span class="n">a</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">]</span>
	<span class="n">h</span><span class="o">.</span><span class="n">IntSlice</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">:</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">v</span>
<span class="p">}</span>
</code></pre>
         </div>
        </div>
       </li>
      </ul>
      
     </article>
     
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-480.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
