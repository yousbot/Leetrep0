<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-1438.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-1438.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>1438 - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode 1438. Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit Description Given an array of integers nums and an integer limit, return the size of the longest non-empty subarray such that the absolute difference between any two elements of this subarray is...">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-1438.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-1438.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-1438.html" rel="stylesheet"/>
   <link href="solution-1438.html" rel="stylesheet"/>
   <link href="solution-1438.html" rel="stylesheet"/>
   <link href="solution-1438.html" rel="stylesheet"/>
   <link href="solution-1438.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="1438 - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit" property="og:title"/>
   <meta content="Leetcode 1438. Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit Description Given an array of integers nums and an integer limit, return the size of the longest non-empty subarray such that the absolute difference between any two elements of this subarray is less than or equal to limit. &amp;nbsp; Example 1: Input: nums = [8,2,4,7], limit = 4 Output: 2 Explanation: All subarrays are: [8] with maximum absolute diff |8-8| = 0 &amp;lt;= 4. [8,2] with maximum absolute diff |8-2| = 6 &amp;gt; 4. [8,2,4] with maximum absolute diff |8-2| = 6 &amp;gt; 4. [8,2,4,7] with maximum absolute diff |8-2| = 6 &amp;gt; 4. [2] with maximum absolute diff |2-2| = 0 &amp;lt;= 4. [2,4] with maximum absolute diff |2-4| = 2 &amp;lt;= 4. [2,4,7] with maximum absolute diff |2-7| = 5 &amp;gt; 4. [4] with maximum absolute diff |4-4| = 0 &amp;lt;= 4. [4,7] with maximum absolute diff |4-7| = 3 &amp;lt;= 4. [7] with maximum absolute diff |7-7| = 0 &amp;lt;= 4. Therefore, the size of the longest subarray is 2. Example 2: Input: nums = [10,1,2,4,7,2], limit = 5 Output: 4 Explanation: The subarray [2,4,7,2] is the longest since the maximum absolute diff is |2-7| = 5 &amp;lt;= 5. Example 3: Input: nums = [4,2,2,2,4,4,2,2], limit = 0 Output: 3 &amp;nbsp; Constraints: 1 &amp;lt;= nums.length &amp;lt;= 105 1 &amp;lt;= nums[i] &amp;lt;= 109 0 &amp;lt;= limit &amp;lt;= 109 Solutions Java C++ Python Go TypeScript class Solution { public int longestSubarray(int[] nums, int limit) { TreeMap&amp;lt;Integer, Integer&amp;gt; tm = new TreeMap&amp;lt;&amp;gt;(); int ans = 0, j = 0; for (int i = 0; i &amp;lt; nums.length; ++i) { tm.put(nums[i], tm.getOrDefault(nums[i], 0) + 1); while (tm.lastKey() - tm.firstKey() &amp;gt; limit) { tm.put(nums[j], tm.get(nums[j]) - 1); if (tm.get(nums[j]) == 0) { tm.remove(nums[j]); } ++j; } ans = Math.max(ans, i - j + 1); } return ans; } } class Solution { public: int longestSubarray(vector&amp;lt;int&amp;gt;&amp;amp; nums, int limit) { multiset&amp;lt;int&amp;gt; s; int ans = 0, j = 0; for (int i = 0; i &amp;lt; nums.size(); ++i) { s.insert(nums[i]); while (*s.rbegin() - *s.begin() &amp;gt; limit) { s.erase(s.find(nums[j++])); } ans = max(ans, i - j + 1); } return ans; } }; from sortedcontainers import SortedList class Solution: def longestSubarray(self, nums: List[int], limit: int) -&amp;gt; int: sl = SortedList() ans = j = 0 for i, v in enumerate(nums): sl.add(v) while sl[-1] - sl[0] &amp;gt; limit: sl.remove(nums[j]) j += 1 ans = max(ans, i - j + 1) return ans func longestSubarray(nums []int, limit int) (ans int) { tm := treemap.NewWithIntComparator() j := 0 for i, v := range nums { if x, ok := tm.Get(v); ok { tm.Put(v, x.(int)+1) } else { tm.Put(v, 1) } for { a, _ := tm.Min() b, _ := tm.Max() if b.(int)-a.(int) &amp;gt; limit { if x, _ := tm.Get(nums[j]); x.(int) == 1 { tm.Remove(nums[j]) } else { tm.Put(nums[j], x.(int)-1) } j++ } else { break } } ans = max(ans, i-j+1) } return } function longestSubarray(nums: number[], limit:..." property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2019-11-07T00:00:00-08:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2019-11-07-1438-Longest-Continuous-Subarray-With-Absolute-Diff-Less-Than-or-Equal-to-Limit/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-1438.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="1438 - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit" property="twitter:title"/>
   <meta content="Leetcode 1438. Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit Description Given an array of integers nums and an integer limit, return the size of the longest non-empty subarray such that the absolute difference between any two elements of this subarray is less than or equal to limit. &amp;nbsp; Example 1: Input: nums = [8,2,4,7], limit = 4 Output: 2 Explanation: All subarrays are: [8] with maximum absolute diff |8-8| = 0 &amp;lt;= 4. [8,2] with maximum absolute diff |8-2| = 6 &amp;gt; 4. [8,2,4] with maximum absolute diff |8-2| = 6 &amp;gt; 4. [8,2,4,7] with maximum absolute diff |8-2| = 6 &amp;gt; 4. [2] with maximum absolute diff |2-2| = 0 &amp;lt;= 4. [2,4] with maximum absolute diff |2-4| = 2 &amp;lt;= 4. [2,4,7] with maximum absolute diff |2-7| = 5 &amp;gt; 4. [4] with maximum absolute diff |4-4| = 0 &amp;lt;= 4. [4,7] with maximum absolute diff |4-7| = 3 &amp;lt;= 4. [7] with maximum absolute diff |7-7| = 0 &amp;lt;= 4. Therefore, the size of the longest subarray is 2. Example 2: Input: nums = [10,1,2,4,7,2], limit = 5 Output: 4 Explanation: The subarray [2,4,7,2] is the longest since the maximum absolute diff is |2-7| = 5 &amp;lt;= 5. Example 3: Input: nums = [4,2,2,2,4,4,2,2], limit = 0 Output: 3 &amp;nbsp; Constraints: 1 &amp;lt;= nums.length &amp;lt;= 105 1 &amp;lt;= nums[i] &amp;lt;= 109 0 &amp;lt;= limit &amp;lt;= 109 Solutions Java C++ Python Go TypeScript class Solution { public int longestSubarray(int[] nums, int limit) { TreeMap&amp;lt;Integer, Integer&amp;gt; tm = new TreeMap&amp;lt;&amp;gt;(); int ans = 0, j = 0; for (int i = 0; i &amp;lt; nums.length; ++i) { tm.put(nums[i], tm.getOrDefault(nums[i], 0) + 1); while (tm.lastKey() - tm.firstKey() &amp;gt; limit) { tm.put(nums[j], tm.get(nums[j]) - 1); if (tm.get(nums[j]) == 0) { tm.remove(nums[j]); } ++j; } ans = Math.max(ans, i - j + 1); } return ans; } } class Solution { public: int longestSubarray(vector&amp;lt;int&amp;gt;&amp;amp; nums, int limit) { multiset&amp;lt;int&amp;gt; s; int ans = 0, j = 0; for (int i = 0; i &amp;lt; nums.size(); ++i) { s.insert(nums[i]); while (*s.rbegin() - *s.begin() &amp;gt; limit) { s.erase(s.find(nums[j++])); } ans = max(ans, i - j + 1); } return ans; } }; from sortedcontainers import SortedList class Solution: def longestSubarray(self, nums: List[int], limit: int) -&amp;gt; int: sl = SortedList() ans = j = 0 for i, v in enumerate(nums): sl.add(v) while sl[-1] - sl[0] &amp;gt; limit: sl.remove(nums[j]) j += 1 ans = max(ans, i - j + 1) return ans func longestSubarray(nums []int, limit int) (ans int) { tm := treemap.NewWithIntComparator() j := 0 for i, v := range nums { if x, ok := tm.Get(v); ok { tm.Put(v, x.(int)+1) } else { tm.Put(v, 1) } for { a, _ := tm.Min() b, _ := tm.Max() if b.(int)-a.(int) &amp;gt; limit { if x, _ := tm.Get(nums[j]); x.(int) == 1 { tm.Remove(nums[j]) } else { tm.Put(nums[j], x.(int)-1) } j++ } else { break } } ans = max(ans, i-j+1) } return } function longestSubarray(nums: number[], limit:..." property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    1438 - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit | Leetcode
   </title>
   <meta content="Jekyll v3.10.0" name="generator">
    <meta content="1438 - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-1438.html" rel="canonical">
          <meta content="https://leetcode.ca/2019-11-07-1438-Longest-Continuous-Subarray-With-Absolute-Diff-Less-Than-or-Equal-to-Limit/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2019-11-07T00:00:00-08:00" property="article:published_time">
              <script type="application/ld+json">
               {"description":"Leetcode","headline":"1438 - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit","dateModified":"2019-11-07T00:00:00-08:00","datePublished":"2019-11-07T00:00:00-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2019-11-07-1438-Longest-Continuous-Subarray-With-Absolute-Diff-Less-Than-or-Equal-to-Limit/"},"url":"https://leetcode.ca/2019-11-07-1438-Longest-Continuous-Subarray-With-Absolute-Diff-Less-Than-or-Equal-to-Limit/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCslk3mmaMJy1enit3L9vWig" data-count="hidden" data-layout="full">
      </div>
      <h1 id="1438-longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit">
       <a href="solution-1438.html">
        1438. Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit
       </a>
      </h1>
      <h2 id="description">
       Description
      </h2>
      <p>
       Given an array of integers
       <code>
        nums
       </code>
       and an integer
       <code>
        limit
       </code>
       , return the size of the longest
       <strong>
        non-empty
       </strong>
       subarray such that the absolute difference between any two elements of this subarray is less than or equal to
       <code>
        limit
       </code>
       <em>
        .
       </em>
      </p>
      <p>
      </p>
      <p>
       <strong class="example">
        Example 1:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> nums = [8,2,4,7], limit = 4
<strong>Output:</strong> 2 
<strong>Explanation:</strong> All subarrays are: 
[8] with maximum absolute diff |8-8| = 0 &lt;= 4.
[8,2] with maximum absolute diff |8-2| = 6 &gt; 4. 
[8,2,4] with maximum absolute diff |8-2| = 6 &gt; 4.
[8,2,4,7] with maximum absolute diff |8-2| = 6 &gt; 4.
[2] with maximum absolute diff |2-2| = 0 &lt;= 4.
[2,4] with maximum absolute diff |2-4| = 2 &lt;= 4.
[2,4,7] with maximum absolute diff |2-7| = 5 &gt; 4.
[4] with maximum absolute diff |4-4| = 0 &lt;= 4.
[4,7] with maximum absolute diff |4-7| = 3 &lt;= 4.
[7] with maximum absolute diff |7-7| = 0 &lt;= 4. 
Therefore, the size of the longest subarray is 2.
</pre>
      <p>
       <strong class="example">
        Example 2:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> nums = [10,1,2,4,7,2], limit = 5
<strong>Output:</strong> 4 
<strong>Explanation:</strong> The subarray [2,4,7,2] is the longest since the maximum absolute diff is |2-7| = 5 &lt;= 5.
</pre>
      <p>
       <strong class="example">
        Example 3:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> nums = [4,2,2,2,4,4,2,2], limit = 0
<strong>Output:</strong> 3
</pre>
      <p>
      </p>
      <p>
       <strong>
        Constraints:
       </strong>
      </p>
      <ul>
       <li>
        <code>
         1 &lt;= nums.length &lt;= 10
         <sup>
          5
         </sup>
        </code>
       </li>
       <li>
        <code>
         1 &lt;= nums[i] &lt;= 10
         <sup>
          9
         </sup>
        </code>
       </li>
       <li>
        <code>
         0 &lt;= limit &lt;= 10
         <sup>
          9
         </sup>
        </code>
       </li>
      </ul>
      <h2 id="solutions">
       Solutions
      </h2>
      <ul class="uk-tab" data-uk-switcher="{connect:'#35f8cff4-7950-47ed-a463-ad7fabe2bce7'}">
       <li class="uk-active">
        <a href="solution-1438.html">
         Java
        </a>
       </li>
       <li>
        <a href="solution-1438.html">
         C++
        </a>
       </li>
       <li>
        <a href="solution-1438.html">
         Python
        </a>
       </li>
       <li>
        <a href="solution-1438.html">
         Go
        </a>
       </li>
       <li>
        <a href="solution-1438.html">
         TypeScript
        </a>
       </li>
      </ul>
      <ul class="uk-switcher uk-margin" id="35f8cff4-7950-47ed-a463-ad7fabe2bce7">
       <li>
        <div class="language-java highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kd">class</span> <span class="nc">Solution</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">longestSubarray</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">nums</span><span class="o">,</span> <span class="kt">int</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">TreeMap</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">tm</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;&gt;();</span>
        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">tm</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">tm</span><span class="o">.</span><span class="na">getOrDefault</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">tm</span><span class="o">.</span><span class="na">lastKey</span><span class="o">()</span> <span class="o">-</span> <span class="n">tm</span><span class="o">.</span><span class="na">firstKey</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">tm</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="n">tm</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">j</span><span class="o">])</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">tm</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">j</span><span class="o">])</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">tm</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">nums</span><span class="o">[</span><span class="n">j</span><span class="o">]);</span>
                <span class="o">}</span>
                <span class="o">++</span><span class="n">j</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">ans</span><span class="o">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-cpp highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="k">class</span> <span class="nc">Solution</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="kt">int</span> <span class="n">longestSubarray</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">nums</span><span class="p">,</span> <span class="kt">int</span> <span class="n">limit</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">multiset</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">s</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">.</span><span class="n">rbegin</span><span class="p">()</span> <span class="o">-</span> <span class="o">*</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">s</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]));</span>
            <span class="p">}</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-py highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kn">from</span> <span class="nn">sortedcontainers</span> <span class="kn">import</span> <span class="n">SortedList</span>


<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">longestSubarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nums</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">()</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
            <span class="n">sl</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">sl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">:</span>
                <span class="n">sl</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>

</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-go highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="k">func</span> <span class="n">longestSubarray</span><span class="p">(</span><span class="n">nums</span> <span class="p">[]</span><span class="kt">int</span><span class="p">,</span> <span class="n">limit</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">ans</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">tm</span> <span class="o">:=</span> <span class="n">treemap</span><span class="o">.</span><span class="n">NewWithIntComparator</span><span class="p">()</span>
	<span class="n">j</span> <span class="o">:=</span> <span class="m">0</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">nums</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="n">ok</span> <span class="p">{</span>
			<span class="n">tm</span><span class="o">.</span><span class="n">Put</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">tm</span><span class="o">.</span><span class="n">Put</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">{</span>
			<span class="n">a</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Min</span><span class="p">()</span>
			<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Max</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span> <span class="p">{</span>
				<span class="k">if</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span> <span class="p">{</span>
					<span class="n">tm</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">tm</span><span class="o">.</span><span class="n">Put</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)</span>
				<span class="p">}</span>
				<span class="n">j</span><span class="o">++</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">break</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span>
<span class="p">}</span>
</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-ts highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kd">function</span> <span class="nx">longestSubarray</span><span class="p">(</span><span class="nx">nums</span><span class="p">:</span> <span class="kr">number</span><span class="p">[],</span> <span class="nx">limit</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">ts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TreapMultiSet</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ts</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">ts</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="o">-</span> <span class="nx">ts</span><span class="p">.</span><span class="nx">first</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ts</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">ans</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">ans</span><span class="p">,</span> <span class="nx">i</span> <span class="o">-</span> <span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">CompareFunction</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span> <span class="kd">extends</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">boolean</span><span class="dl">'</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nx">a</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span>
    <span class="nx">b</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span> <span class="kd">extends</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span> <span class="p">?</span> <span class="kr">number</span> <span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">ITreapMultiSet</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nx">Iterable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">add</span><span class="p">:</span> <span class="p">(...</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">;</span>
    <span class="nl">has</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">delete</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>

    <span class="nl">bisectLeft</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">bisectRight</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">number</span><span class="p">;</span>

    <span class="nl">indexOf</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">lastIndexOf</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">number</span><span class="p">;</span>

    <span class="nl">at</span><span class="p">:</span> <span class="p">(</span><span class="na">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">first</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">last</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

    <span class="nl">lower</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">higher</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">floor</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">ceil</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

    <span class="nl">shift</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">pop</span><span class="p">:</span> <span class="p">(</span><span class="nx">index</span><span class="p">?:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

    <span class="nl">count</span><span class="p">:</span> <span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">number</span><span class="p">;</span>

    <span class="nl">keys</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nl">values</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nl">rvalues</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nl">entries</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="nx">T</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="k">readonly</span> <span class="na">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">number</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">;</span>
    <span class="nl">count</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">priority</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">left</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nl">right</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">priority</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">getSize</span><span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">?.</span><span class="nx">size</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">getFac</span><span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">?.</span><span class="nx">priority</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">pushUp</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
        <span class="nx">tmp</span> <span class="o">+=</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
        <span class="nx">tmp</span> <span class="o">+=</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">right</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">rotateRight</span><span class="p">():</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// eslint-disable-next-line @typescript-eslint/no-this-alias</span>
        <span class="kd">let</span> <span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">left</span><span class="p">?.</span><span class="nx">right</span> <span class="o">??</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">left</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="nx">node</span><span class="p">);</span>
        <span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">left</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">?.</span><span class="nx">pushUp</span><span class="p">();</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">rotateLeft</span><span class="p">():</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// eslint-disable-next-line @typescript-eslint/no-this-alias</span>
        <span class="kd">let</span> <span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">;</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="nx">right</span><span class="p">?.</span><span class="nx">left</span> <span class="o">??</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">right</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">node</span><span class="p">);</span>
        <span class="nx">right</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">right</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">?.</span><span class="nx">pushUp</span><span class="p">();</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">TreapMultiSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">number</span><span class="o">&gt;</span> <span class="k">implements</span> <span class="nx">ITreapMultiSet</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="na">root</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="na">compareFn</span><span class="p">:</span> <span class="nx">CompareFunction</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="na">leftBound</span><span class="p">:</span> <span class="nx">T</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="na">rightBound</span><span class="p">:</span> <span class="nx">T</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="nx">compareFn</span><span class="p">?:</span> <span class="nx">CompareFunction</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="o">&gt;</span><span class="p">);</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="na">compareFn</span><span class="p">:</span> <span class="nx">CompareFunction</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="o">&gt;</span><span class="p">,</span> <span class="na">leftBound</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="na">rightBound</span><span class="p">:</span> <span class="nx">T</span><span class="p">);</span>
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="na">compareFn</span><span class="p">:</span> <span class="nx">CompareFunction</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="na">a</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">,</span>
        <span class="na">leftBound</span><span class="p">:</span> <span class="kr">any</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span>
        <span class="na">rightBound</span><span class="p">:</span> <span class="kr">any</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">rightBound</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">priority</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">leftBound</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">priority</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">leftBound</span> <span class="o">=</span> <span class="nx">leftBound</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">rightBound</span> <span class="o">=</span> <span class="nx">rightBound</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span> <span class="o">=</span> <span class="nx">compareFn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">size</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">height</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">getHeight</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">getHeight</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">),</span> <span class="nx">getHeight</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">));</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">getHeight</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Returns true if value is a member.
     */</span>
    <span class="nx">has</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Add value to sorted set.
     */</span>
    <span class="nx">add</span><span class="p">(...</span><span class="na">values</span><span class="p">:</span> <span class="nx">T</span><span class="p">[]):</span> <span class="k">this</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span>
            <span class="na">parent</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
            <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">right</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">):</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TreapNode</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getFac</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">rotateRight</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="dl">'</span><span class="s1">right</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TreapNode</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getFac</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">rotateLeft</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">parent</span><span class="p">.</span><span class="nx">pushUp</span><span class="p">();</span>
        <span class="p">};</span>

        <span class="nx">values</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">));</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Remove value from sorted set if it is a member.
     * If value is not a member, do nothing.
     */</span>
    <span class="k">delete</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span>
            <span class="na">parent</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span>
            <span class="na">direction</span><span class="p">:</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">right</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">):</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="o">--</span><span class="p">;</span>
                    <span class="nx">node</span><span class="p">?.</span><span class="nx">pushUp</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// </span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nx">node</span><span class="p">.</span><span class="nx">right</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span>
                        <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getFac</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getFac</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span>
                    <span class="p">)</span> <span class="p">{</span>
                        <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">rotateRight</span><span class="p">();</span>
                        <span class="nx">dfs</span><span class="p">(</span><span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]?.</span><span class="nx">right</span> <span class="o">??</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span><span class="o">!</span><span class="p">,</span> <span class="dl">'</span><span class="s1">right</span><span class="dl">'</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">rotateLeft</span><span class="p">();</span>
                        <span class="nx">dfs</span><span class="p">(</span><span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]?.</span><span class="nx">left</span> <span class="o">??</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">parent</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span><span class="o">!</span><span class="p">,</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="dl">'</span><span class="s1">right</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">parent</span><span class="p">?.</span><span class="nx">pushUp</span><span class="p">();</span>
        <span class="p">};</span>

        <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Returns an index to insert value in the sorted set.
     * If the value is already present, the insertion point will be before (to the left of) any existing values.
     */</span>
    <span class="nx">bisectLeft</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Returns an index to insert value in the sorted set.
     * If the value is already present, the insertion point will be before (to the right of) any existing values.
     */</span>
    <span class="nx">bisectRight</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Returns the index of the first occurrence of a value in the set, or -1 if it is not present.
     */</span>
    <span class="nx">indexOf</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">isExist</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">isExist</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">isExist</span> <span class="p">?</span> <span class="nx">res</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Returns the index of the last occurrence of a value in the set, or -1 if it is not present.
     */</span>
    <span class="nx">lastIndexOf</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">isExist</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">isExist</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">isExist</span> <span class="p">?</span> <span class="nx">res</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Returns the item located at the specified index.
     * @param index The zero-based index of the desired code unit. A negative index will count back from the last item.
     */</span>
    <span class="nx">at</span><span class="p">(</span><span class="na">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">index</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">rank</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">rank</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">rank</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span> <span class="o">&gt;=</span> <span class="nx">rank</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">rank</span> <span class="o">-</span> <span class="nx">TreapNode</span><span class="p">.</span><span class="nx">getSize</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="o">-</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">leftBound</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">rightBound</span><span class="p">]</span> <span class="k">as</span> <span class="kr">any</span><span class="p">[]).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Find and return the element less than `val`, return `undefined` if no such element found.
     */</span>
    <span class="nx">lower</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

            <span class="kd">const</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">tmp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="k">as</span> <span class="kr">any</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">leftBound</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Find and return the element greater than `val`, return `undefined` if no such element found.
     */</span>
    <span class="nx">higher</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

            <span class="kd">const</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">tmp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="k">as</span> <span class="kr">any</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">rightBound</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Find and return the element less than or equal to `val`, return `undefined` if no such element found.
     */</span>
    <span class="nx">floor</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

            <span class="kd">const</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">tmp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="k">as</span> <span class="kr">any</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">leftBound</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description Find and return the element greater than or equal to `val`, return `undefined` if no such element found.
     */</span>
    <span class="nx">ceil</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

            <span class="kd">const</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">tmp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="k">as</span> <span class="kr">any</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">rightBound</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @complexity `O(logn)`
     * @description
     * Returns the last element from set.
     * If the set is empty, undefined is returned.
     */</span>
    <span class="nx">first</span><span class="p">():</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">iter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">inOrder</span><span class="p">();</span>
        <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">rightBound</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @complexity `O(logn)`
     * @description
     * Returns the last element from set.
     * If the set is empty, undefined is returned .
     */</span>
    <span class="nx">last</span><span class="p">():</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">iter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">reverseInOrder</span><span class="p">();</span>
        <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">leftBound</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @complexity `O(logn)`
     * @description
     * Removes the first element from an set and returns it.
     * If the set is empty, undefined is returned and the set is not modified.
     */</span>
    <span class="nx">shift</span><span class="p">():</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">first</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">first</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">first</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">first</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @complexity `O(logn)`
     * @description
     * Removes the last element from an set and returns it.
     * If the set is empty, undefined is returned and the set is not modified.
     */</span>
    <span class="nx">pop</span><span class="p">(</span><span class="nx">index</span><span class="p">?:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">last</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">last</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">last</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">last</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">toDelete</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">toDelete</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">toDelete</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">toDelete</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     *
     * @complexity `O(logn)`
     * @description
     * Returns number of occurrences of value in the sorted set.
     */</span>
    <span class="nx">count</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">compare</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compareFn</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">dfs</span> <span class="o">=</span> <span class="p">(</span><span class="na">node</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="nx">dfs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">*</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]():</span> <span class="nx">Generator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @description
     * Returns an iterable of keys in the set.
     */</span>
    <span class="o">*</span><span class="nx">keys</span><span class="p">():</span> <span class="nx">Generator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @description
     * Returns an iterable of values in the set.
     */</span>
    <span class="o">*</span><span class="nx">values</span><span class="p">():</span> <span class="nx">Generator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">iter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">inOrder</span><span class="p">();</span>
        <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">steps</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">_</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">;</span> <span class="nx">_</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">yield</span> <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @description
     * Returns a generator for reversed order traversing the set.
     */</span>
    <span class="o">*</span><span class="nx">rvalues</span><span class="p">():</span> <span class="nx">Generator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">iter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">reverseInOrder</span><span class="p">();</span>
        <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">steps</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">_</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">;</span> <span class="nx">_</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">yield</span> <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @description
     * Returns an iterable of key, value pairs for every entry in the set.
     */</span>
    <span class="o">*</span><span class="nx">entries</span><span class="p">():</span> <span class="nx">IterableIterator</span><span class="o">&lt;</span><span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="nx">T</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">iter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">inOrder</span><span class="p">();</span>
        <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">steps</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">yield</span> <span class="p">[</span><span class="nx">i</span><span class="p">,</span> <span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="o">*</span><span class="nx">inOrder</span><span class="p">(</span><span class="na">root</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">):</span> <span class="nx">Generator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">root</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">inOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">_</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">_</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">yield</span> <span class="nx">root</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">inOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">right</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="o">*</span><span class="nx">reverseInOrder</span><span class="p">(</span><span class="na">root</span><span class="p">:</span> <span class="nx">TreapNode</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">):</span> <span class="nx">Generator</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">root</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">reverseInOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">right</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">_</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">_</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">yield</span> <span class="nx">root</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">reverseInOrder</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>
         </div>
        </div>
       </li>
      </ul>
      
     </article>
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-1438.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
