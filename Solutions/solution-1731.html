<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-1731.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-1731.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>1731 - The Number of Employees Which Report to Each Employee</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode Formatted question description: https://leetcode.ca/all/1731.html 1731. The Number of Employees Which Report to Each Employee Level Easy Description Table: Employees +-------------+----------+ | Column Name | Type | +-------------+----------+ | employee_id | int | | name | varchar | | reports_to | int | | age |...">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-1731.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-1731.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-1731.html" rel="stylesheet"/>
   <link href="solution-1731.html" rel="stylesheet"/>
   <link href="solution-1731.html" rel="stylesheet"/>
   <link href="solution-1731.html" rel="stylesheet"/>
   <link href="solution-1731.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="1731 - The Number of Employees Which Report to Each Employee" property="og:title"/>
   <meta content="Leetcode




Formatted question description: https://leetcode.ca/all/1731.html

1731. The Number of Employees Which Report to Each Employee
Level
Easy

Description
Table: Employees
+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| employee_id | int      |
| name        | varchar  |
| reports_to  | int      |
| age         | int      |
+-------------+----------+
employee_id is the primary key for this table.
This table contains information about the employees and the id of the manager they report to. Some employees do not report to anyone (reports_to is null). 


Write an SQL query to report the ids and the names of the people that other employees reported to (excluding null values), the number of employees who report to them, and the average age of those members rounded to the nearest integer.

Return the result table ordered by employee_id.

The query result format is in the following example:

Employees table:
+-------------+---------+------------+-----+
| employee_id | name    | reports_to | age |
+-------------+---------+------------+-----+
| 9           | Hercy   | null       | 43  |
| 6           | Alice   | 9          | 41  |
| 4           | Bob     | 9          | 36  |
| 2           | Winston | null       | 37  |
+-------------+---------+------------+-----+

Result table:
+-------------+-------+---------------+-------------+
| employee_id | name  | reports_count | average_age |
+-------------+-------+---------------+-------------+
| 9           | Hercy | 2             | 39          |
+-------------+-------+---------------+-------------+
Alice and Bob report to Hercy, hence Hercy has 2 people report to him, and the average of their age is (41+36)/2 = 38.5 which is 39 after rounding it to the nearest integer.


Solution
First, find the people that other employees report to, remove null values, and calculate the values of reports_count and average_age. Next, use left join to obtain the names.
# Write your MySQL query statement below
select e1.employee_id, name, reports_count, average_age
    from (
        select reports_to as employee_id, count(distinct employee_id) as reports_count,
            round(avg(age)) as average_age
            from Employees
            group by reports_to
            having reports_to is not null
    ) e1
    left join Employees e2
    on e1.employee_id = e2.employee_id
    order by e1.employee_id;


All Problems

All Solutions" property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2021-03-14T22:21:01-07:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2021-03-14-1731-The-Number-of-Employees-Which-Report-to-Each-Employee/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-1731.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="1731 - The Number of Employees Which Report to Each Employee" property="twitter:title"/>
   <meta content="Leetcode




Formatted question description: https://leetcode.ca/all/1731.html

1731. The Number of Employees Which Report to Each Employee
Level
Easy

Description
Table: Employees
+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| employee_id | int      |
| name        | varchar  |
| reports_to  | int      |
| age         | int      |
+-------------+----------+
employee_id is the primary key for this table.
This table contains information about the employees and the id of the manager they report to. Some employees do not report to anyone (reports_to is null). 


Write an SQL query to report the ids and the names of the people that other employees reported to (excluding null values), the number of employees who report to them, and the average age of those members rounded to the nearest integer.

Return the result table ordered by employee_id.

The query result format is in the following example:

Employees table:
+-------------+---------+------------+-----+
| employee_id | name    | reports_to | age |
+-------------+---------+------------+-----+
| 9           | Hercy   | null       | 43  |
| 6           | Alice   | 9          | 41  |
| 4           | Bob     | 9          | 36  |
| 2           | Winston | null       | 37  |
+-------------+---------+------------+-----+

Result table:
+-------------+-------+---------------+-------------+
| employee_id | name  | reports_count | average_age |
+-------------+-------+---------------+-------------+
| 9           | Hercy | 2             | 39          |
+-------------+-------+---------------+-------------+
Alice and Bob report to Hercy, hence Hercy has 2 people report to him, and the average of their age is (41+36)/2 = 38.5 which is 39 after rounding it to the nearest integer.


Solution
First, find the people that other employees report to, remove null values, and calculate the values of reports_count and average_age. Next, use left join to obtain the names.
# Write your MySQL query statement below
select e1.employee_id, name, reports_count, average_age
    from (
        select reports_to as employee_id, count(distinct employee_id) as reports_count,
            round(avg(age)) as average_age
            from Employees
            group by reports_to
            having reports_to is not null
    ) e1
    left join Employees e2
    on e1.employee_id = e2.employee_id
    order by e1.employee_id;


All Problems

All Solutions" property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    1731 - The Number of Employees Which Report to Each Employee | Leetcode
   </title>
   <meta content="Jekyll v3.9.4" name="generator">
    <meta content="1731 - The Number of Employees Which Report to Each Employee" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-1731.html" rel="canonical">
          <meta content="https://leetcode.ca/2021-03-14-1731-The-Number-of-Employees-Which-Report-to-Each-Employee/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2021-03-14T22:21:01-07:00" property="article:published_time">
              <script type="application/ld+json">
               {"headline":"1731 - The Number of Employees Which Report to Each Employee","dateModified":"2021-03-14T22:21:01-07:00","datePublished":"2021-03-14T22:21:01-07:00","description":"Leetcode","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2021-03-14-1731-The-Number-of-Employees-Which-Report-to-Each-Employee/"},"url":"https://leetcode.ca/2021-03-14-1731-The-Number-of-Employees-Which-Report-to-Each-Employee/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCDRuzBvLGzyVvgPyohrahrA" data-count="hidden" data-layout="full">
      </div>
      <p>
       Formatted question description:
       <a href="solution-1731.html">
        https://leetcode.ca/all/1731.html
       </a>
      </p>
      <h1 id="1731-the-number-of-employees-which-report-to-each-employee">
       1731. The Number of Employees Which Report to Each Employee
      </h1>
      <h2 id="level">
       Level
      </h2>
      <p>
       Easy
      </p>
      <h2 id="description">
       Description
      </h2>
      <p>
       Table:
       <code class="language-plaintext highlighter-rouge">
        Employees
       </code>
      </p>
      <div class="language-plaintext highlighter-rouge">
       <div class="highlight">
        <pre class="highlight"><code>+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| employee_id | int      |
| name        | varchar  |
| reports_to  | int      |
| age         | int      |
+-------------+----------+
employee_id is the primary key for this table.
This table contains information about the employees and the id of the manager they report to. Some employees do not report to anyone (reports_to is null). 
</code></pre>
       </div>
      </div>
      <p>
       Write an SQL query to report the ids and the names of the people that other employees reported to (excluding null values), the number of employees who report to them, and the average age of those members rounded to the nearest integer.
      </p>
      <p>
       Return the result table ordered by
       <code class="language-plaintext highlighter-rouge">
        employee_id
       </code>
       .
      </p>
      <p>
       The query result format is in the following example:
      </p>
      <div class="language-plaintext highlighter-rouge">
       <div class="highlight">
        <pre class="highlight"><code>Employees table:
+-------------+---------+------------+-----+
| employee_id | name    | reports_to | age |
+-------------+---------+------------+-----+
| 9           | Hercy   | null       | 43  |
| 6           | Alice   | 9          | 41  |
| 4           | Bob     | 9          | 36  |
| 2           | Winston | null       | 37  |
+-------------+---------+------------+-----+

Result table:
+-------------+-------+---------------+-------------+
| employee_id | name  | reports_count | average_age |
+-------------+-------+---------------+-------------+
| 9           | Hercy | 2             | 39          |
+-------------+-------+---------------+-------------+
Alice and Bob report to Hercy, hence Hercy has 2 people report to him, and the average of their age is (41+36)/2 = 38.5 which is 39 after rounding it to the nearest integer.
</code></pre>
       </div>
      </div>
      <h2 id="solution">
       Solution
      </h2>
      <p>
       First, find the people that other employees report to, remove
       <code class="language-plaintext highlighter-rouge">
        null
       </code>
       values, and calculate the values of
       <code class="language-plaintext highlighter-rouge">
        reports_count
       </code>
       and
       <code class="language-plaintext highlighter-rouge">
        average_age
       </code>
       . Next, use left join to obtain the names.
      </p>
      <div class="language-sql highlighter-rouge">
       <div class="highlight">
        <pre class="highlight"><code><span class="o">#</span> <span class="k">Write</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">query</span> <span class="k">statement</span> <span class="n">below</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">reports_count</span><span class="p">,</span> <span class="n">average_age</span>
    <span class="k">from</span> <span class="p">(</span>
        <span class="k">select</span> <span class="n">reports_to</span> <span class="k">as</span> <span class="n">employee_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">employee_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">reports_count</span><span class="p">,</span>
            <span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">age</span><span class="p">))</span> <span class="k">as</span> <span class="n">average_age</span>
            <span class="k">from</span> <span class="n">Employees</span>
            <span class="k">group</span> <span class="k">by</span> <span class="n">reports_to</span>
            <span class="k">having</span> <span class="n">reports_to</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
    <span class="p">)</span> <span class="n">e1</span>
    <span class="k">left</span> <span class="k">join</span> <span class="n">Employees</span> <span class="n">e2</span>
    <span class="k">on</span> <span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span> <span class="o">=</span> <span class="n">e2</span><span class="p">.</span><span class="n">employee_id</span>
    <span class="k">order</span> <span class="k">by</span> <span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span><span class="p">;</span>
</code></pre>
       </div>
      </div>
      
     </article>
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-1731.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
