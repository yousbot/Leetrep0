<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-3061.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-3061.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>3061 - Calculate Trapping Rain Water</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode 3061. Calculate Trapping Rain Water Description Table: Heights +-------------+------+ \| Column Name \| Type \| +-------------+------+ \| id \| int \| \| height \| int \| +-------------+------+ id is the primary key (column with unique values) for this table, and it is guaranteed to be...">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-3061.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-3061.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-3061.html" rel="stylesheet"/>
   <link href="solution-3061.html" rel="stylesheet"/>
   <link href="solution-3061.html" rel="stylesheet"/>
   <link href="solution-3061.html" rel="stylesheet"/>
   <link href="solution-3061.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="3061 - Calculate Trapping Rain Water" property="og:title"/>
   <meta content='Leetcode




3061. Calculate Trapping Rain Water



Description

Table: Heights


+-------------+------+
\| Column Name \| Type \|
+-------------+------+
\| id          \| int  \|
\| height      \| int  \|
+-------------+------+
id is the primary key (column with unique values) for this table, and it is guaranteed to be in sequential order.
Each row of this table contains an id and height.


Write a solution to calculate the amount of rainwater can be trapped between the bars in the landscape, considering that each bar has a width of 1 unit.

Return the result table in any order.

The result format is in the following example.

&amp;nbsp;
Example 1:


Input: 
Heights table:
+-----+--------+
\| id  \| height \|
+-----+--------+
\| 1   \| 0      \|
\| 2   \| 1      \|
\| 3   \| 0      \|
\| 4   \| 2      \|
\| 5   \| 1      \|
\| 6   \| 0      \|
\| 7   \| 1      \|
\| 8   \| 3      \|
\| 9   \| 2      \|
\| 10  \| 1      \|
\| 11  \| 2      \|
\| 12  \| 1      \|
+-----+--------+
Output: 
+---------------------+
\| total_trapped_water \| 
+---------------------+
\| 6                   \| 
+---------------------+
Explanation: 


The elevation map depicted above (in the black section) is graphically represented with the x-axis denoting the id and the y-axis representing the heights [0,1,0,2,1,0,1,3,2,1,2,1]. In this scenario, 6 units of rainwater are trapped within the blue section.


Solutions

Solution 1: Window Function + Summation

We use the window function MAX(height) OVER (ORDER BY id) to calculate the maximum height for each position and its left side, and use MAX(height) OVER (ORDER BY id DESC) to calculate the maximum height for each position and its right side, denoted as l and r respectively. Then, the amount of water stored at each position is min(l, r) - height. Finally, we sum them up.



	Python

	SQL





	
import pandas as pd


def calculate_trapped_rain_water(heights: pd.DataFrame) -&amp;gt; pd.DataFrame:
    heights["l"] = heights["height"].cummax()
    heights["r"] = heights["height"][::-1].cummax()[::-1]
    heights["trapped_water"] = heights[["l", "r"]].min(axis=1) - heights["height"]
    return pd.DataFrame({"total_trapped_water": [heights["trapped_water"].sum()]})




	
# Write your MySQL query statement below
WITH
    T AS (
        SELECT
            *,
            MAX(height) OVER (ORDER BY id) AS l,
            MAX(height) OVER (ORDER BY id DESC) AS r
        FROM Heights
    )
SELECT SUM(LEAST(l, r) - height) AS total_trapped_water
FROM T;






All Problems

All Solutions' property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2024-03-12T00:00:00-07:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2024-03-12-3061-Calculate-Trapping-Rain-Water/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-3061.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="3061 - Calculate Trapping Rain Water" property="twitter:title"/>
   <meta content='Leetcode




3061. Calculate Trapping Rain Water



Description

Table: Heights


+-------------+------+
\| Column Name \| Type \|
+-------------+------+
\| id          \| int  \|
\| height      \| int  \|
+-------------+------+
id is the primary key (column with unique values) for this table, and it is guaranteed to be in sequential order.
Each row of this table contains an id and height.


Write a solution to calculate the amount of rainwater can be trapped between the bars in the landscape, considering that each bar has a width of 1 unit.

Return the result table in any order.

The result format is in the following example.

&amp;nbsp;
Example 1:


Input: 
Heights table:
+-----+--------+
\| id  \| height \|
+-----+--------+
\| 1   \| 0      \|
\| 2   \| 1      \|
\| 3   \| 0      \|
\| 4   \| 2      \|
\| 5   \| 1      \|
\| 6   \| 0      \|
\| 7   \| 1      \|
\| 8   \| 3      \|
\| 9   \| 2      \|
\| 10  \| 1      \|
\| 11  \| 2      \|
\| 12  \| 1      \|
+-----+--------+
Output: 
+---------------------+
\| total_trapped_water \| 
+---------------------+
\| 6                   \| 
+---------------------+
Explanation: 


The elevation map depicted above (in the black section) is graphically represented with the x-axis denoting the id and the y-axis representing the heights [0,1,0,2,1,0,1,3,2,1,2,1]. In this scenario, 6 units of rainwater are trapped within the blue section.


Solutions

Solution 1: Window Function + Summation

We use the window function MAX(height) OVER (ORDER BY id) to calculate the maximum height for each position and its left side, and use MAX(height) OVER (ORDER BY id DESC) to calculate the maximum height for each position and its right side, denoted as l and r respectively. Then, the amount of water stored at each position is min(l, r) - height. Finally, we sum them up.



	Python

	SQL





	
import pandas as pd


def calculate_trapped_rain_water(heights: pd.DataFrame) -&amp;gt; pd.DataFrame:
    heights["l"] = heights["height"].cummax()
    heights["r"] = heights["height"][::-1].cummax()[::-1]
    heights["trapped_water"] = heights[["l", "r"]].min(axis=1) - heights["height"]
    return pd.DataFrame({"total_trapped_water": [heights["trapped_water"].sum()]})




	
# Write your MySQL query statement below
WITH
    T AS (
        SELECT
            *,
            MAX(height) OVER (ORDER BY id) AS l,
            MAX(height) OVER (ORDER BY id DESC) AS r
        FROM Heights
    )
SELECT SUM(LEAST(l, r) - height) AS total_trapped_water
FROM T;






All Problems

All Solutions' property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    3061 - Calculate Trapping Rain Water | Leetcode
   </title>
   <meta content="Jekyll v3.10.0" name="generator">
    <meta content="3061 - Calculate Trapping Rain Water" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-3061.html" rel="canonical">
          <meta content="https://leetcode.ca/2024-03-12-3061-Calculate-Trapping-Rain-Water/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2024-03-12T00:00:00-07:00" property="article:published_time">
              <script type="application/ld+json">
               {"description":"Leetcode","headline":"3061 - Calculate Trapping Rain Water","dateModified":"2024-03-12T00:00:00-07:00","datePublished":"2024-03-12T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2024-03-12-3061-Calculate-Trapping-Rain-Water/"},"url":"https://leetcode.ca/2024-03-12-3061-Calculate-Trapping-Rain-Water/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCslk3mmaMJy1enit3L9vWig" data-count="hidden" data-layout="full">
      </div>
      <h1 id="3061-calculate-trapping-rain-water">
       <a href="solution-3061.html">
        3061. Calculate Trapping Rain Water
       </a>
      </h1>
      <!-- tags:Database -->
      <h2 id="description">
       Description
      </h2>
      <p>
       Table:
       <font face="monospace">
        Heights
       </font>
      </p>
      <pre>
+-------------+------+
\| Column Name \| Type \|
+-------------+------+
\| id          \| int  \|
\| height      \| int  \|
+-------------+------+
id is the primary key (column with unique values) for this table, and it is guaranteed to be in sequential order.
Each row of this table contains an id and height.
</pre>
      <p>
       Write a solution to calculate the amount of rainwater can be
       <strong>
        trapped between the bars
       </strong>
       in the landscape, considering that each bar has a
       <strong>
        width
       </strong>
       of
       <code>
        1
       </code>
       unit.
      </p>
      <p>
       Return
       <em>
        the result table in
       </em>
       <strong>
        any
       </strong>
       <em>
        order.
       </em>
      </p>
      <p>
       The result format is in the following example.
      </p>
      <p>
      </p>
      <p>
       <strong class="example">
        Example 1:
       </strong>
      </p>
      <pre>
<strong>Input:</strong> 
Heights table:
+-----+--------+
\| id  \| height \|
+-----+--------+
\| 1   \| 0      \|
\| 2   \| 1      \|
\| 3   \| 0      \|
\| 4   \| 2      \|
\| 5   \| 1      \|
\| 6   \| 0      \|
\| 7   \| 1      \|
\| 8   \| 3      \|
\| 9   \| 2      \|
\| 10  \| 1      \|
\| 11  \| 2      \|
\| 12  \| 1      \|
+-----+--------+
<strong>Output:</strong> 
+---------------------+
\| total_trapped_water \| 
+---------------------+
\| 6                   \| 
+---------------------+
<strong>Explanation:</strong> 
<img src="https://fastly.jsdelivr.net/gh/doocs/leetcode@main/solution/3000-3099/3061.Calculate%20Trapping%20Rain%20Water/images/trapping_rain_water.png" style="width:500px; height:200px;"/>

The elevation map depicted above (in the black section) is graphically represented with the x-axis denoting the id and the y-axis representing the heights [0,1,0,2,1,0,1,3,2,1,2,1]. In this scenario, 6 units of rainwater are trapped within the blue section.
</pre>
      <h2 id="solutions">
       Solutions
      </h2>
      <h3 id="solution-1-window-function--summation">
       Solution 1: Window Function + Summation
      </h3>
      <p>
       We use the window function
       <code class="language-plaintext highlighter-rouge">
        MAX(height) OVER (ORDER BY id)
       </code>
       to calculate the maximum height for each position and its left side, and use
       <code class="language-plaintext highlighter-rouge">
        MAX(height) OVER (ORDER BY id DESC)
       </code>
       to calculate the maximum height for each position and its right side, denoted as
       <code class="language-plaintext highlighter-rouge">
        l
       </code>
       and
       <code class="language-plaintext highlighter-rouge">
        r
       </code>
       respectively. Then, the amount of water stored at each position is
       <code class="language-plaintext highlighter-rouge">
        min(l, r) - height
       </code>
       . Finally, we sum them up.
      </p>
      <ul class="uk-tab" data-uk-switcher="{connect:'#4f10e0b4-d5fc-4622-b5be-9badbd467a4d'}">
       <li class="uk-active">
        <a href="solution-3061.html">
         Python
        </a>
       </li>
       <li>
        <a href="solution-3061.html">
         SQL
        </a>
       </li>
      </ul>
      <ul class="uk-switcher uk-margin" id="4f10e0b4-d5fc-4622-b5be-9badbd467a4d">
       <li>
        <div class="language-py highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>


<span class="k">def</span> <span class="nf">calculate_trapped_rain_water</span><span class="p">(</span><span class="n">heights</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">heights</span><span class="p">[</span><span class="s">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">heights</span><span class="p">[</span><span class="s">"height"</span><span class="p">].</span><span class="n">cummax</span><span class="p">()</span>
    <span class="n">heights</span><span class="p">[</span><span class="s">"r"</span><span class="p">]</span> <span class="o">=</span> <span class="n">heights</span><span class="p">[</span><span class="s">"height"</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">cummax</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">heights</span><span class="p">[</span><span class="s">"trapped_water"</span><span class="p">]</span> <span class="o">=</span> <span class="n">heights</span><span class="p">[[</span><span class="s">"l"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">]].</span><span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">heights</span><span class="p">[</span><span class="s">"height"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"total_trapped_water"</span><span class="p">:</span> <span class="p">[</span><span class="n">heights</span><span class="p">[</span><span class="s">"trapped_water"</span><span class="p">].</span><span class="nb">sum</span><span class="p">()]})</span>

</code></pre>
         </div>
        </div>
       </li>
       <li>
        <div class="language-sql highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="o">#</span> <span class="k">Write</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">query</span> <span class="k">statement</span> <span class="n">below</span>
<span class="k">WITH</span>
    <span class="n">T</span> <span class="k">AS</span> <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="k">MAX</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">l</span><span class="p">,</span>
            <span class="k">MAX</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">r</span>
        <span class="k">FROM</span> <span class="n">Heights</span>
    <span class="p">)</span>
<span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">LEAST</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_trapped_water</span>
<span class="k">FROM</span> <span class="n">T</span><span class="p">;</span>

</code></pre>
         </div>
        </div>
       </li>
      </ul>
      
     </article>
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-3061.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
