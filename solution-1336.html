<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="solution-1336.html" rel="shortcut icon" type="image/png"/>
  <link href="solution-1336.html" rel="stylesheet">
   <script src="assets_js_uikit.min.js" type="text/javascript">
   </script>
   <script src="assets_js_uikit-icons.min.js" type="text/javascript">
   </script>
   <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        packages: {'[+]': ['ams']}  // Include the 'ams' package
      },
      svg: {
        fontCache: 'global'
      }
    };
   </script>
   <script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
   </script>
   <!-- below block is overlapping with SEO plugin generated title and description   -->
   <!-- 
  <title>1336 - Number of Transactions per Visit</title>

  
  <meta name="author" content="Leetcode">
  

  
  <meta name="description" content="Leetcode 1336. Number of Transactions per Visit Description Table: Visits +---------------+---------+ | Column Name | Type | +---------------+---------+ | user_id | int | | visit_date | date | +---------------+---------+ (user_id, visit_date) is the primary key (combination of columns with unique values) for this table. Each row...">
   -->
   <meta content="LeetCode, Solution, Company Tag, Unlock Prime, Java, C++, Interview, Job, Algorithm, SQL, Canada" name="keywords"/>
   <link href="solution-1336.html" rel="alternate" title="Leetcode" type="application/rss+xml"/>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K108N8L891">
   </script>
   <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K108N8L891');
   </script>
   <!-- End Google Analytics -->
   <script async="" data-ad-client="ca-pub-6766885420008650" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
   </script>
   <link crossorigin="anonymous" href="solution-1336.html" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet"/>
   <link href="solution-1336.html" rel="stylesheet"/>
   <link href="solution-1336.html" rel="stylesheet"/>
   <link href="solution-1336.html" rel="stylesheet"/>
   <link href="solution-1336.html" rel="stylesheet"/>
   <link href="solution-1336.html" rel="stylesheet"/>
   <meta content="Leetcode" property="og:site_name"/>
   <meta content="1336 - Number of Transactions per Visit" property="og:title"/>
   <meta content="Leetcode 1336. Number of Transactions per Visit Description Table: Visits +---------------+---------+ | Column Name | Type | +---------------+---------+ | user_id | int | | visit_date | date | +---------------+---------+ (user_id, visit_date) is the primary key (combination of columns with unique values) for this table. Each row of this table indicates that user_id has visited the bank in visit_date. &amp;nbsp; Table: Transactions +------------------+---------+ | Column Name | Type | +------------------+---------+ | user_id | int | | transaction_date | date | | amount | int | +------------------+---------+ This table may contain duplicates rows. Each row of this table indicates that user_id has done a transaction of amount in transaction_date. It is guaranteed that the user has visited the bank in the transaction_date.(i.e The Visits table contains (user_id, transaction_date) in one row) &amp;nbsp; A bank wants to draw a chart of the number of transactions bank visitors did in one visit to the bank and the corresponding number of visitors who have done this number of transaction in one visit. Write a solution&amp;nbsp;to find how many users visited the bank and didn&amp;#39;t do any transactions, how many visited the bank and did one transaction, and so on. The result table will contain two columns: transactions_count which is the number of transactions done in one visit. visits_count which is the corresponding number of users who did transactions_count in one visit to the bank. transactions_count should take all values from 0 to max(transactions_count) done by one or more users. Return the result table ordered by transactions_count. The result format is in the following example. &amp;nbsp; Example 1: Input: Visits table: +---------+------------+ | user_id | visit_date | +---------+------------+ | 1 | 2020-01-01 | | 2 | 2020-01-02 | | 12 | 2020-01-01 | | 19 | 2020-01-03 | | 1 | 2020-01-02 | | 2 | 2020-01-03 | | 1 | 2020-01-04 | | 7 | 2020-01-11 | | 9 | 2020-01-25 | | 8 | 2020-01-28 | +---------+------------+ Transactions table: +---------+------------------+--------+ | user_id | transaction_date | amount | +---------+------------------+--------+ | 1 | 2020-01-02 | 120 | | 2 | 2020-01-03 | 22 | | 7 | 2020-01-11 | 232 | | 1 | 2020-01-04 | 7 | | 9 | 2020-01-25 | 33 | | 9 | 2020-01-25 | 66 | | 8 | 2020-01-28 | 1 | | 9 | 2020-01-25 | 99 | +---------+------------------+--------+ Output: +--------------------+--------------+ | transactions_count | visits_count | +--------------------+--------------+ | 0 | 4 | | 1 | 5 | | 2 | 0 | | 3 | 1 | +--------------------+--------------+ Explanation: The chart drawn for this example is shown above. * For transactions_count = 0, The visits (1, &amp;quot;2020-01-01&amp;quot;), (2, &amp;quot;2020-01-02&amp;quot;), (12, &amp;quot;2020-01-01&amp;quot;) and (19, &amp;quot;2020-01-03&amp;quot;) did no transactions so visits_count = 4. * For transactions_count = 1, The visits (2, &amp;quot;2020-01-03&amp;quot;), (7, &amp;quot;2020-01-11&amp;quot;), (8, &amp;quot;2020-01-28&amp;quot;), (1, &amp;quot;2020-01-02&amp;quot;) and (1, &amp;quot;2020-01-04&amp;quot;) did one transaction so visits_count = 5. * For transactions_count = 2, No customers visited the bank and did two transactions so visits_count = 0...." property="og:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" property="og:image"/>
   <!-- remove canonical below to use SEO plugin -->
   <meta content="article" property="og:type"/>
   <meta content="Leetcode" property="og:article:author"/>
   <meta content="2019-07-28T00:00:00-07:00" property="og:article:published_time"/>
   <meta content="https://leetcode.ca/2019-07-28-1336-Number-of-Transactions-per-Visit/" property="og:url"/>
   <!-- <link rel="canonical" href="solution-1336.html"> -->
   <meta content="summary" name="twitter:card"/>
   <meta content="@" name="twitter:site"/>
   <meta content="@" name="twitter:creator"/>
   <meta content="1336 - Number of Transactions per Visit" property="twitter:title"/>
   <meta content="Leetcode 1336. Number of Transactions per Visit Description Table: Visits +---------------+---------+ | Column Name | Type | +---------------+---------+ | user_id | int | | visit_date | date | +---------------+---------+ (user_id, visit_date) is the primary key (combination of columns with unique values) for this table. Each row of this table indicates that user_id has visited the bank in visit_date. &amp;nbsp; Table: Transactions +------------------+---------+ | Column Name | Type | +------------------+---------+ | user_id | int | | transaction_date | date | | amount | int | +------------------+---------+ This table may contain duplicates rows. Each row of this table indicates that user_id has done a transaction of amount in transaction_date. It is guaranteed that the user has visited the bank in the transaction_date.(i.e The Visits table contains (user_id, transaction_date) in one row) &amp;nbsp; A bank wants to draw a chart of the number of transactions bank visitors did in one visit to the bank and the corresponding number of visitors who have done this number of transaction in one visit. Write a solution&amp;nbsp;to find how many users visited the bank and didn&amp;#39;t do any transactions, how many visited the bank and did one transaction, and so on. The result table will contain two columns: transactions_count which is the number of transactions done in one visit. visits_count which is the corresponding number of users who did transactions_count in one visit to the bank. transactions_count should take all values from 0 to max(transactions_count) done by one or more users. Return the result table ordered by transactions_count. The result format is in the following example. &amp;nbsp; Example 1: Input: Visits table: +---------+------------+ | user_id | visit_date | +---------+------------+ | 1 | 2020-01-01 | | 2 | 2020-01-02 | | 12 | 2020-01-01 | | 19 | 2020-01-03 | | 1 | 2020-01-02 | | 2 | 2020-01-03 | | 1 | 2020-01-04 | | 7 | 2020-01-11 | | 9 | 2020-01-25 | | 8 | 2020-01-28 | +---------+------------+ Transactions table: +---------+------------------+--------+ | user_id | transaction_date | amount | +---------+------------------+--------+ | 1 | 2020-01-02 | 120 | | 2 | 2020-01-03 | 22 | | 7 | 2020-01-11 | 232 | | 1 | 2020-01-04 | 7 | | 9 | 2020-01-25 | 33 | | 9 | 2020-01-25 | 66 | | 8 | 2020-01-28 | 1 | | 9 | 2020-01-25 | 99 | +---------+------------------+--------+ Output: +--------------------+--------------+ | transactions_count | visits_count | +--------------------+--------------+ | 0 | 4 | | 1 | 5 | | 2 | 0 | | 3 | 1 | +--------------------+--------------+ Explanation: The chart drawn for this example is shown above. * For transactions_count = 0, The visits (1, &amp;quot;2020-01-01&amp;quot;), (2, &amp;quot;2020-01-02&amp;quot;), (12, &amp;quot;2020-01-01&amp;quot;) and (19, &amp;quot;2020-01-03&amp;quot;) did no transactions so visits_count = 4. * For transactions_count = 1, The visits (2, &amp;quot;2020-01-03&amp;quot;), (7, &amp;quot;2020-01-11&amp;quot;), (8, &amp;quot;2020-01-28&amp;quot;), (1, &amp;quot;2020-01-02&amp;quot;) and (1, &amp;quot;2020-01-04&amp;quot;) did one transaction so visits_count = 5. * For transactions_count = 2, No customers visited the bank and did two transactions so visits_count = 0...." property="twitter:description"/>
   <meta content="https://leetcode.ca/assets/img/avatar-icon.jpg" name="twitter:image"/>
   <!-- Begin Jekyll SEO tag v2.6.1 -->
   <title>
    1336 - Number of Transactions per Visit | Leetcode
   </title>
   <meta content="Jekyll v3.10.0" name="generator">
    <meta content="1336 - Number of Transactions per Visit" property="og:title">
     <meta content="Leetcode" name="author">
      <meta content="en_US" property="og:locale">
       <meta content="Leetcode" name="description">
        <meta content="Leetcode" property="og:description">
         <link href="solution-1336.html" rel="canonical">
          <meta content="https://leetcode.ca/2019-07-28-1336-Number-of-Transactions-per-Visit/" property="og:url">
           <meta content="Leetcode" property="og:site_name">
            <meta content="article" property="og:type">
             <meta content="2019-07-28T00:00:00-07:00" property="article:published_time">
              <script type="application/ld+json">
               {"description":"Leetcode","headline":"1336 - Number of Transactions per Visit","dateModified":"2019-07-28T00:00:00-07:00","datePublished":"2019-07-28T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://leetcode.ca/2019-07-28-1336-Number-of-Transactions-per-Visit/"},"url":"https://leetcode.ca/2019-07-28-1336-Number-of-Transactions-per-Visit/","author":{"@type":"Person","name":"Leetcode"},"@type":"BlogPosting","@context":"https://schema.org"}
              </script>
              <!-- End Jekyll SEO tag -->
             </meta>
            </meta>
           </meta>
          </meta>
         </link>
        </meta>
       </meta>
      </meta>
     </meta>
    </meta>
   </meta>
  </link>
 </head>
 <body>
  
  <!-- TODO this file has become a mess, refactor it -->
  
  <div class="container-md">
   <div class="row">
    <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
     <article class="blog-post" role="main">
      
      <script src="https://apis.google.com/js/platform.js">
      </script>
      <div class="g-ytsubscribe" data-channelid="UCslk3mmaMJy1enit3L9vWig" data-count="hidden" data-layout="full">
      </div>
      <h1 id="1336-number-of-transactions-per-visit">
       <a href="solution-1336.html">
        1336. Number of Transactions per Visit
       </a>
      </h1>
      <h2 id="description">
       Description
      </h2>
      <p>
       Table:
       <code>
        Visits
       </code>
      </p>
      <pre>
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| user_id       | int     |
| visit_date    | date    |
+---------------+---------+
(user_id, visit_date) is the primary key (combination of columns with unique values) for this table.
Each row of this table indicates that user_id has visited the bank in visit_date.
</pre>
      <p>
      </p>
      <p>
       Table:
       <code>
        Transactions
       </code>
      </p>
      <pre>
+------------------+---------+
| Column Name      | Type    |
+------------------+---------+
| user_id          | int     |
| transaction_date | date    |
| amount           | int     |
+------------------+---------+
This table may contain duplicates rows.
Each row of this table indicates that user_id has done a transaction of amount in transaction_date.
It is guaranteed that the user has visited the bank in the transaction_date.(i.e The Visits table contains (user_id, transaction_date) in one row)
</pre>
      <p>
      </p>
      <p>
       A bank wants to draw a chart of the number of transactions bank visitors did in one visit to the bank and the corresponding number of visitors who have done this number of transaction in one visit.
      </p>
      <p>
       Write a solutionÂ to find how many users visited the bank and didn't do any transactions, how many visited the bank and did one transaction, and so on.
      </p>
      <p>
       The result table will contain two columns:
      </p>
      <ul>
       <li>
        <code>
         transactions_count
        </code>
        which is the number of transactions done in one visit.
       </li>
       <li>
        <code>
         visits_count
        </code>
        which is the corresponding number of users who did
        <code>
         transactions_count
        </code>
        in one visit to the bank.
       </li>
      </ul>
      <p>
       <code>
        transactions_count
       </code>
       should take all values from
       <code>
        0
       </code>
       to
       <code>
        max(transactions_count)
       </code>
       done by one or more users.
      </p>
      <p>
       Return the result table ordered by
       <code>
        transactions_count
       </code>
       .
      </p>
      <p>
       The result format is in the following example.
      </p>
      <p>
      </p>
      <p>
       <strong class="example">
        Example 1:
       </strong>
      </p>
      <p>
       <img alt="" src="https://fastly.jsdelivr.net/gh/doocs/leetcode@main/solution/1300-1399/1336.Number%20of%20Transactions%20per%20Visit/images/chart.png" style="width: 500px; height: 299px;"/>
      </p>
      <pre>
<strong>Input:</strong> 
Visits table:
+---------+------------+
| user_id | visit_date |
+---------+------------+
| 1       | 2020-01-01 |
| 2       | 2020-01-02 |
| 12      | 2020-01-01 |
| 19      | 2020-01-03 |
| 1       | 2020-01-02 |
| 2       | 2020-01-03 |
| 1       | 2020-01-04 |
| 7       | 2020-01-11 |
| 9       | 2020-01-25 |
| 8       | 2020-01-28 |
+---------+------------+
Transactions table:
+---------+------------------+--------+
| user_id | transaction_date | amount |
+---------+------------------+--------+
| 1       | 2020-01-02       | 120    |
| 2       | 2020-01-03       | 22     |
| 7       | 2020-01-11       | 232    |
| 1       | 2020-01-04       | 7      |
| 9       | 2020-01-25       | 33     |
| 9       | 2020-01-25       | 66     |
| 8       | 2020-01-28       | 1      |
| 9       | 2020-01-25       | 99     |
+---------+------------------+--------+
<strong>Output:</strong> 
+--------------------+--------------+
| transactions_count | visits_count |
+--------------------+--------------+
| 0                  | 4            |
| 1                  | 5            |
| 2                  | 0            |
| 3                  | 1            |
+--------------------+--------------+
<strong>Explanation:</strong> The chart drawn for this example is shown above.
* For transactions_count = 0, The visits (1, "2020-01-01"), (2, "2020-01-02"), (12, "2020-01-01") and (19, "2020-01-03") did no transactions so visits_count = 4.
* For transactions_count = 1, The visits (2, "2020-01-03"), (7, "2020-01-11"), (8, "2020-01-28"), (1, "2020-01-02") and (1, "2020-01-04") did one transaction so visits_count = 5.
* For transactions_count = 2, No customers visited the bank and did two transactions so visits_count = 0.
* For transactions_count = 3, The visit (9, "2020-01-25") did three transactions so visits_count = 1.
* For transactions_count &gt;= 4, No customers visited the bank and did more than three transactions so we will stop at transactions_count = 3
</pre>
      <h2 id="solutions">
       Solutions
      </h2>
      <ul class="uk-tab" data-uk-switcher="{connect:'#b280be1b-abc1-4b58-b5ec-e5d39e175148'}">
       <li class="uk-active">
        <a href="solution-1336.html">
         SQL
        </a>
       </li>
      </ul>
      <ul class="uk-switcher uk-margin" id="b280be1b-abc1-4b58-b5ec-e5d39e175148">
       <li>
        <div class="language-sql highlighter-rouge">
         <div class="highlight">
          <pre class="highlight"><code><span class="o">#</span> <span class="k">Write</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">query</span> <span class="k">statement</span> <span class="n">below</span>
<span class="k">WITH</span> <span class="k">RECURSIVE</span>
    <span class="n">S</span> <span class="k">AS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="mi">0</span> <span class="k">AS</span> <span class="n">n</span>
        <span class="k">UNION</span>
        <span class="k">SELECT</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">FROM</span> <span class="n">S</span>
        <span class="k">WHERE</span>
            <span class="n">n</span> <span class="o">&lt;</span> <span class="p">(</span>
                <span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
                <span class="k">FROM</span>
                    <span class="p">(</span>
                        <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cnt</span>
                        <span class="k">FROM</span> <span class="n">Transactions</span>
                        <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">transaction_date</span>
                    <span class="p">)</span> <span class="k">AS</span> <span class="n">t</span>
            <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">T</span> <span class="k">AS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">v</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">visit_date</span><span class="p">,</span> <span class="n">IFNULL</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cnt</span>
        <span class="k">FROM</span>
            <span class="n">Visits</span> <span class="k">AS</span> <span class="n">v</span>
            <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="p">(</span>
                <span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">transaction_date</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cnt</span>
                <span class="k">FROM</span> <span class="n">Transactions</span>
                <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
            <span class="p">)</span> <span class="k">AS</span> <span class="n">t</span>
                <span class="k">ON</span> <span class="n">v</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">user_id</span> <span class="k">AND</span> <span class="n">v</span><span class="p">.</span><span class="n">visit_date</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">transaction_date</span>
    <span class="p">)</span>
<span class="k">SELECT</span> <span class="n">n</span> <span class="k">AS</span> <span class="n">transactions_count</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">visits_count</span>
<span class="k">FROM</span>
    <span class="n">S</span> <span class="k">AS</span> <span class="n">s</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">T</span> <span class="k">AS</span> <span class="n">t</span> <span class="k">ON</span> <span class="n">s</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">cnt</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">n</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">n</span><span class="p">;</span>

</code></pre>
         </div>
        </div>
       </li>
      </ul>
      
     </article>
     
     
     <div class="disqus-comments">
      <div class="comments">
       <div id="disqus_thread">
       </div>
       <script type="text/javascript">
        var disqus_shortname = 'leetcodeca';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
       </script>
       <noscript>
        Please enable JavaScript to view the
        <a href="solution-1336.html">
         comments powered by Disqus.
        </a>
       </noscript>
      </div>
     </div>
    </div>
   </div>
  </div>
  
  <script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js">
  </script>
  <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
  <script src="assets_js_beautifuljekyll.js">
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js">
  </script>
  <script src="assets_js_anchor-js-config.js">
  </script>
 </body>
</html>
